---

title: Dialog System

keywords: fastai
sidebar: home_sidebar

summary: "Question Answering Automated Dialog System"
description: "Question Answering Automated Dialog System"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/01_dialog_system.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>09:03:24 INFO:test: hola
09:03:24 ERROR:test: adios
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>09:02:25 INFO:test: hola
09:02:25 DEBUG:test: que tal?
09:02:25 ERROR:test: adios
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="run_shell_installs" class="doc_header"><code>run_shell_installs</code><a href="https://github.com/kikejimenez/let_me_answer_for_you/tree/master/let_me_answer_for_you/dialog_system.py#L22" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>run_shell_installs</code>()</p>
</blockquote>
<p>Run install commands</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">run_shell_installs</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>07:46:15 DEBUG: pip install deeppavlov
07:46:17 DEBUG:Requirement already satisfied: deeppavlov in /opt/conda/lib/python3.7/site-packages (0.10.0)
Requirement already satisfied: pyopenssl==19.1.0 in /opt/conda/lib/python3.7/site-packages (from deeppavlov) (19.1.0)
Requirement already satisfied: aio-pika==6.4.1 in /opt/conda/lib/python3.7/site-packages (from deeppavlov) (6.4.1)
Requirement already satisfied: h5py==2.10.0 in /opt/conda/lib/python3.7/site-packages (from deeppavlov) (2.10.0)
Requirement already satisfied: pytz==2019.1 in /opt/conda/lib/python3.7/site-packages (from deeppavlov) (2019.1)
Requirement already satisfied: pymorphy2-dicts-ru in /opt/conda/lib/python3.7/site-packages (from deeppavlov) (2.4.404381.4453942)
Requirement already satisfied: pydantic==1.3 in /opt/conda/lib/python3.7/site-packages (from deeppavlov) (1.3)
Requirement already satisfied: sacremoses==0.0.35 in /opt/conda/lib/python3.7/site-packages (from deeppavlov) (0.0.35)
Requirement already satisfied: requests==2.22.0 in /opt/conda/lib/python3.7/site-packages (from deeppavlov) (2.22.0)
Requirement already satisfied: pytelegrambotapi==3.6.7 in /opt/conda/lib/python3.7/site-packages (from deeppavlov) (3.6.7)
Requirement already satisfied: tqdm==4.41.1 in /opt/conda/lib/python3.7/site-packages (from deeppavlov) (4.41.1)
Requirement already satisfied: pymorphy2==0.8 in /opt/conda/lib/python3.7/site-packages (from deeppavlov) (0.8)
Requirement already satisfied: uvicorn==0.11.1 in /opt/conda/lib/python3.7/site-packages (from deeppavlov) (0.11.1)
Requirement already satisfied: scikit-learn==0.21.2 in /opt/conda/lib/python3.7/site-packages (from deeppavlov) (0.21.2)
Requirement already satisfied: scipy==1.4.1 in /opt/conda/lib/python3.7/site-packages (from deeppavlov) (1.4.1)
Requirement already satisfied: overrides==2.7.0 in /opt/conda/lib/python3.7/site-packages (from deeppavlov) (2.7.0)
Requirement already satisfied: Cython==0.29.14 in /opt/conda/lib/python3.7/site-packages (from deeppavlov) (0.29.14)
Requirement already satisfied: numpy==1.18.0 in /opt/conda/lib/python3.7/site-packages (from deeppavlov) (1.18.0)
Requirement already satisfied: rusenttokenize==0.0.5 in /opt/conda/lib/python3.7/site-packages (from deeppavlov) (0.0.5)
Requirement already satisfied: ruamel.yaml==0.15.100 in /opt/conda/lib/python3.7/site-packages (from deeppavlov) (0.15.100)
Requirement already satisfied: nltk==3.4.5 in /opt/conda/lib/python3.7/site-packages (from deeppavlov) (3.4.5)
Requirement already satisfied: fastapi==0.47.1 in /opt/conda/lib/python3.7/site-packages (from deeppavlov) (0.47.1)
Requirement already satisfied: pandas==0.25.3 in /opt/conda/lib/python3.7/site-packages (from deeppavlov) (0.25.3)
Requirement already satisfied: six&gt;=1.5.2 in /opt/conda/lib/python3.7/site-packages (from pyopenssl==19.1.0-&gt;deeppavlov) (1.14.0)
Requirement already satisfied: cryptography&gt;=2.8 in /opt/conda/lib/python3.7/site-packages (from pyopenssl==19.1.0-&gt;deeppavlov) (2.8)
Requirement already satisfied: yarl in /opt/conda/lib/python3.7/site-packages (from aio-pika==6.4.1-&gt;deeppavlov) (1.4.2)
Requirement already satisfied: aiormq&lt;4,&gt;=3.2.0 in /opt/conda/lib/python3.7/site-packages (from aio-pika==6.4.1-&gt;deeppavlov) (3.2.2)
Requirement already satisfied: joblib in /opt/conda/lib/python3.7/site-packages (from sacremoses==0.0.35-&gt;deeppavlov) (0.15.1)
Requirement already satisfied: click in /opt/conda/lib/python3.7/site-packages (from sacremoses==0.0.35-&gt;deeppavlov) (7.1.2)
Requirement already satisfied: idna&lt;2.9,&gt;=2.5 in /opt/conda/lib/python3.7/site-packages (from requests==2.22.0-&gt;deeppavlov) (2.8)
Requirement already satisfied: certifi&gt;=2017.4.17 in /opt/conda/lib/python3.7/site-packages (from requests==2.22.0-&gt;deeppavlov) (2019.11.28)
Requirement already satisfied: urllib3!=1.25.0,!=1.25.1,&lt;1.26,&gt;=1.21.1 in /opt/conda/lib/python3.7/site-packages (from requests==2.22.0-&gt;deeppavlov) (1.25.7)
Requirement already satisfied: chardet&lt;3.1.0,&gt;=3.0.2 in /opt/conda/lib/python3.7/site-packages (from requests==2.22.0-&gt;deeppavlov) (3.0.4)
Requirement already satisfied: dawg-python&gt;=0.7 in /opt/conda/lib/python3.7/site-packages (from pymorphy2==0.8-&gt;deeppavlov) (0.7.2)
Requirement already satisfied: pymorphy2-dicts&lt;3.0,&gt;=2.4 in /opt/conda/lib/python3.7/site-packages (from pymorphy2==0.8-&gt;deeppavlov) (2.4.393442.3710985)
Requirement already satisfied: docopt&gt;=0.6 in /opt/conda/lib/python3.7/site-packages (from pymorphy2==0.8-&gt;deeppavlov) (0.6.2)
Requirement already satisfied: uvloop&gt;=0.14.0; sys_platform != &#34;win32&#34; and sys_platform != &#34;cygwin&#34; and platform_python_implementation != &#34;pypy&#34; in /opt/conda/lib/python3.7/site-packages (from uvicorn==0.11.1-&gt;deeppavlov) (0.14.0)
Requirement already satisfied: h11&lt;0.10,&gt;=0.8 in /opt/conda/lib/python3.7/site-packages (from uvicorn==0.11.1-&gt;deeppavlov) (0.9.0)
Requirement already satisfied: httptools==0.0.13; sys_platform != &#34;win32&#34; and sys_platform != &#34;cygwin&#34; and platform_python_implementation != &#34;pypy&#34; in /opt/conda/lib/python3.7/site-packages (from uvicorn==0.11.1-&gt;deeppavlov) (0.0.13)
Requirement already satisfied: websockets==8.* in /opt/conda/lib/python3.7/site-packages (from uvicorn==0.11.1-&gt;deeppavlov) (8.1)
Requirement already satisfied: starlette&lt;=0.12.9,&gt;=0.12.9 in /opt/conda/lib/python3.7/site-packages (from fastapi==0.47.1-&gt;deeppavlov) (0.12.9)
Requirement already satisfied: python-dateutil&gt;=2.6.1 in /opt/conda/lib/python3.7/site-packages (from pandas==0.25.3-&gt;deeppavlov) (2.8.1)
Requirement already satisfied: cffi!=1.11.3,&gt;=1.8 in /opt/conda/lib/python3.7/site-packages (from cryptography&gt;=2.8-&gt;pyopenssl==19.1.0-&gt;deeppavlov) (1.14.0)
Requirement already satisfied: multidict&gt;=4.0 in /opt/conda/lib/python3.7/site-packages (from yarl-&gt;aio-pika==6.4.1-&gt;deeppavlov) (4.7.6)
Requirement already satisfied: pamqp==2.3.0 in /opt/conda/lib/python3.7/site-packages (from aiormq&lt;4,&gt;=3.2.0-&gt;aio-pika==6.4.1-&gt;deeppavlov) (2.3.0)
Requirement already satisfied: pycparser in /opt/conda/lib/python3.7/site-packages (from cffi!=1.11.3,&gt;=1.8-&gt;cryptography&gt;=2.8-&gt;pyopenssl==19.1.0-&gt;deeppavlov) (2.20)

07:46:17 DEBUG: python -m deeppavlov install squad
07:46:58 DEBUG:Collecting tensorflow==1.15.2
  Downloading tensorflow-1.15.2-cp37-cp37m-manylinux2010_x86_64.whl (110.5 MB)
Requirement already satisfied: numpy&lt;2.0,&gt;=1.16.0 in /opt/conda/lib/python3.7/site-packages (from tensorflow==1.15.2) (1.18.0)
Requirement already satisfied: tensorboard&lt;1.16.0,&gt;=1.15.0 in /opt/conda/lib/python3.7/site-packages (from tensorflow==1.15.2) (1.15.0)
Requirement already satisfied: wheel&gt;=0.26; python_version &gt;= &#34;3&#34; in /opt/conda/lib/python3.7/site-packages (from tensorflow==1.15.2) (0.34.2)
Requirement already satisfied: termcolor&gt;=1.1.0 in /opt/conda/lib/python3.7/site-packages (from tensorflow==1.15.2) (1.1.0)
Requirement already satisfied: tensorflow-estimator==1.15.1 in /opt/conda/lib/python3.7/site-packages (from tensorflow==1.15.2) (1.15.1)
Requirement already satisfied: grpcio&gt;=1.8.6 in /opt/conda/lib/python3.7/site-packages (from tensorflow==1.15.2) (1.29.0)
Requirement already satisfied: absl-py&gt;=0.7.0 in /opt/conda/lib/python3.7/site-packages (from tensorflow==1.15.2) (0.9.0)
Requirement already satisfied: wrapt&gt;=1.11.1 in /opt/conda/lib/python3.7/site-packages (from tensorflow==1.15.2) (1.12.1)
Requirement already satisfied: google-pasta&gt;=0.1.6 in /opt/conda/lib/python3.7/site-packages (from tensorflow==1.15.2) (0.2.0)
Requirement already satisfied: keras-applications&gt;=1.0.8 in /opt/conda/lib/python3.7/site-packages (from tensorflow==1.15.2) (1.0.8)
Requirement already satisfied: keras-preprocessing&gt;=1.0.5 in /opt/conda/lib/python3.7/site-packages (from tensorflow==1.15.2) (1.1.2)
Requirement already satisfied: opt-einsum&gt;=2.3.2 in /opt/conda/lib/python3.7/site-packages (from tensorflow==1.15.2) (3.2.1)
Requirement already satisfied: six&gt;=1.10.0 in /opt/conda/lib/python3.7/site-packages (from tensorflow==1.15.2) (1.14.0)
Requirement already satisfied: protobuf&gt;=3.6.1 in /opt/conda/lib/python3.7/site-packages (from tensorflow==1.15.2) (3.12.2)
Requirement already satisfied: astor&gt;=0.6.0 in /opt/conda/lib/python3.7/site-packages (from tensorflow==1.15.2) (0.8.1)
Requirement already satisfied: gast==0.2.2 in /opt/conda/lib/python3.7/site-packages (from tensorflow==1.15.2) (0.2.2)
Requirement already satisfied: markdown&gt;=2.6.8 in /opt/conda/lib/python3.7/site-packages (from tensorboard&lt;1.16.0,&gt;=1.15.0-&gt;tensorflow==1.15.2) (3.2.2)
Requirement already satisfied: setuptools&gt;=41.0.0 in /opt/conda/lib/python3.7/site-packages (from tensorboard&lt;1.16.0,&gt;=1.15.0-&gt;tensorflow==1.15.2) (46.0.0.post20200311)
Requirement already satisfied: werkzeug&gt;=0.11.15 in /opt/conda/lib/python3.7/site-packages (from tensorboard&lt;1.16.0,&gt;=1.15.0-&gt;tensorflow==1.15.2) (1.0.1)
Requirement already satisfied: h5py in /opt/conda/lib/python3.7/site-packages (from keras-applications&gt;=1.0.8-&gt;tensorflow==1.15.2) (2.10.0)
Requirement already satisfied: importlib-metadata; python_version &lt; &#34;3.8&#34; in /opt/conda/lib/python3.7/site-packages (from markdown&gt;=2.6.8-&gt;tensorboard&lt;1.16.0,&gt;=1.15.0-&gt;tensorflow==1.15.2) (1.5.0)
Requirement already satisfied: zipp&gt;=0.5 in /opt/conda/lib/python3.7/site-packages (from importlib-metadata; python_version &lt; &#34;3.8&#34;-&gt;markdown&gt;=2.6.8-&gt;tensorboard&lt;1.16.0,&gt;=1.15.0-&gt;tensorflow==1.15.2) (3.1.0)
Installing collected packages: tensorflow
  Attempting uninstall: tensorflow
    Found existing installation: tensorflow 1.15.3
    Uninstalling tensorflow-1.15.3:
      Successfully uninstalled tensorflow-1.15.3
Successfully installed tensorflow-1.15.2

07:46:58 DEBUG: python -m deeppavlov install squad_bert
07:47:06 DEBUG:Requirement already satisfied: tensorflow==1.15.2 in /opt/conda/lib/python3.7/site-packages (1.15.2)
Requirement already satisfied: protobuf&gt;=3.6.1 in /opt/conda/lib/python3.7/site-packages (from tensorflow==1.15.2) (3.12.2)
Requirement already satisfied: opt-einsum&gt;=2.3.2 in /opt/conda/lib/python3.7/site-packages (from tensorflow==1.15.2) (3.2.1)
Requirement already satisfied: grpcio&gt;=1.8.6 in /opt/conda/lib/python3.7/site-packages (from tensorflow==1.15.2) (1.29.0)
Requirement already satisfied: absl-py&gt;=0.7.0 in /opt/conda/lib/python3.7/site-packages (from tensorflow==1.15.2) (0.9.0)
Requirement already satisfied: wheel&gt;=0.26; python_version &gt;= &#34;3&#34; in /opt/conda/lib/python3.7/site-packages (from tensorflow==1.15.2) (0.34.2)
Requirement already satisfied: numpy&lt;2.0,&gt;=1.16.0 in /opt/conda/lib/python3.7/site-packages (from tensorflow==1.15.2) (1.18.0)
Requirement already satisfied: keras-applications&gt;=1.0.8 in /opt/conda/lib/python3.7/site-packages (from tensorflow==1.15.2) (1.0.8)
Requirement already satisfied: wrapt&gt;=1.11.1 in /opt/conda/lib/python3.7/site-packages (from tensorflow==1.15.2) (1.12.1)
Requirement already satisfied: astor&gt;=0.6.0 in /opt/conda/lib/python3.7/site-packages (from tensorflow==1.15.2) (0.8.1)
Requirement already satisfied: tensorboard&lt;1.16.0,&gt;=1.15.0 in /opt/conda/lib/python3.7/site-packages (from tensorflow==1.15.2) (1.15.0)
Requirement already satisfied: termcolor&gt;=1.1.0 in /opt/conda/lib/python3.7/site-packages (from tensorflow==1.15.2) (1.1.0)
Requirement already satisfied: tensorflow-estimator==1.15.1 in /opt/conda/lib/python3.7/site-packages (from tensorflow==1.15.2) (1.15.1)
Requirement already satisfied: google-pasta&gt;=0.1.6 in /opt/conda/lib/python3.7/site-packages (from tensorflow==1.15.2) (0.2.0)
Requirement already satisfied: keras-preprocessing&gt;=1.0.5 in /opt/conda/lib/python3.7/site-packages (from tensorflow==1.15.2) (1.1.2)
Requirement already satisfied: six&gt;=1.10.0 in /opt/conda/lib/python3.7/site-packages (from tensorflow==1.15.2) (1.14.0)
Requirement already satisfied: gast==0.2.2 in /opt/conda/lib/python3.7/site-packages (from tensorflow==1.15.2) (0.2.2)
Requirement already satisfied: setuptools in /opt/conda/lib/python3.7/site-packages (from protobuf&gt;=3.6.1-&gt;tensorflow==1.15.2) (46.0.0.post20200311)
Requirement already satisfied: h5py in /opt/conda/lib/python3.7/site-packages (from keras-applications&gt;=1.0.8-&gt;tensorflow==1.15.2) (2.10.0)
Requirement already satisfied: werkzeug&gt;=0.11.15 in /opt/conda/lib/python3.7/site-packages (from tensorboard&lt;1.16.0,&gt;=1.15.0-&gt;tensorflow==1.15.2) (1.0.1)
Requirement already satisfied: markdown&gt;=2.6.8 in /opt/conda/lib/python3.7/site-packages (from tensorboard&lt;1.16.0,&gt;=1.15.0-&gt;tensorflow==1.15.2) (3.2.2)
Requirement already satisfied: importlib-metadata; python_version &lt; &#34;3.8&#34; in /opt/conda/lib/python3.7/site-packages (from markdown&gt;=2.6.8-&gt;tensorboard&lt;1.16.0,&gt;=1.15.0-&gt;tensorflow==1.15.2) (1.5.0)
Requirement already satisfied: zipp&gt;=0.5 in /opt/conda/lib/python3.7/site-packages (from importlib-metadata; python_version &lt; &#34;3.8&#34;-&gt;markdown&gt;=2.6.8-&gt;tensorboard&lt;1.16.0,&gt;=1.15.0-&gt;tensorflow==1.15.2) (3.1.0)
Collecting git+https://github.com/deepmipt/bert.git@feat/multi_gpu
  Cloning https://github.com/deepmipt/bert.git (to revision feat/multi_gpu) to /tmp/pip-req-build-oml61k8u
Building wheels for collected packages: bert-dp
  Building wheel for bert-dp (setup.py): started
  Building wheel for bert-dp (setup.py): finished with status &#39;done&#39;
  Created wheel for bert-dp: filename=bert_dp-1.0-py3-none-any.whl size=23580 sha256=cb35f801d1db1f0d978e9763052cc9a9e5bbe15288a4b97d0da8b77bb3a57733
  Stored in directory: /tmp/pip-ephem-wheel-cache-nunuhlvp/wheels/44/29/b2/ee614cb7f97ba5c2d220029eaede3af4b74331ad31d6e2f4eb
Successfully built bert-dp
Installing collected packages: bert-dp
Successfully installed bert-dp-1.0

07:47:06 DEBUG: python -m deeppavlov install fasttext_avg_autofaq
07:47:59 DEBUG:Collecting fasttext==0.9.1
  Downloading fasttext-0.9.1.tar.gz (57 kB)
Requirement already satisfied: pybind11&gt;=2.2 in /opt/conda/lib/python3.7/site-packages (from fasttext==0.9.1) (2.5.0)
Requirement already satisfied: setuptools&gt;=0.7.0 in /opt/conda/lib/python3.7/site-packages (from fasttext==0.9.1) (46.0.0.post20200311)
Requirement already satisfied: numpy in /opt/conda/lib/python3.7/site-packages (from fasttext==0.9.1) (1.18.0)
Building wheels for collected packages: fasttext
  Building wheel for fasttext (setup.py): started
  Building wheel for fasttext (setup.py): finished with status &#39;done&#39;
  Created wheel for fasttext: filename=fasttext-0.9.1-cp37-cp37m-linux_x86_64.whl size=2481942 sha256=03c873997c3a17c711205d377a4d67d63b42cda99f92e58efd60c0b317ef418c
  Stored in directory: /home/jovyan/.cache/pip/wheels/b2/5b/4b/9c582c778bb93aaad8fc855d5e79f49eae34f59e363a22c422
Successfully built fasttext
Installing collected packages: fasttext
Successfully installed fasttext-0.9.1

07:47:59 DEBUG: python -m deeppavlov install fasttext_tfidf_autofaq
07:48:01 DEBUG:Requirement already satisfied: fasttext==0.9.1 in /opt/conda/lib/python3.7/site-packages (0.9.1)
Requirement already satisfied: numpy in /opt/conda/lib/python3.7/site-packages (from fasttext==0.9.1) (1.18.0)
Requirement already satisfied: setuptools&gt;=0.7.0 in /opt/conda/lib/python3.7/site-packages (from fasttext==0.9.1) (46.0.0.post20200311)
Requirement already satisfied: pybind11&gt;=2.2 in /opt/conda/lib/python3.7/site-packages (from fasttext==0.9.1) (2.5.0)

07:48:01 DEBUG: python -m deeppavlov install tfidf_autofaq
07:48:02 DEBUG:
07:48:02 DEBUG: python -m deeppavlov install tfidf_logreg_autofaq 
07:48:04 DEBUG:
07:48:04 DEBUG: python -m deeppavlov install tfidf_logreg_en_faq
07:48:22 DEBUG:Collecting spacy==2.2.3
  Downloading spacy-2.2.3-cp37-cp37m-manylinux1_x86_64.whl (10.4 MB)
Collecting wasabi&lt;1.1.0,&gt;=0.4.0
  Downloading wasabi-0.6.0-py3-none-any.whl (20 kB)
Requirement already satisfied: requests&lt;3.0.0,&gt;=2.13.0 in /opt/conda/lib/python3.7/site-packages (from spacy==2.2.3) (2.22.0)
Collecting thinc&lt;7.4.0,&gt;=7.3.0
  Downloading thinc-7.3.1-cp37-cp37m-manylinux1_x86_64.whl (2.2 MB)
Requirement already satisfied: numpy&gt;=1.15.0 in /opt/conda/lib/python3.7/site-packages (from spacy==2.2.3) (1.18.0)
Collecting murmurhash&lt;1.1.0,&gt;=0.28.0
  Downloading murmurhash-1.0.2-cp37-cp37m-manylinux1_x86_64.whl (19 kB)
Collecting plac&lt;1.2.0,&gt;=0.9.6
  Downloading plac-1.1.3-py2.py3-none-any.whl (20 kB)
Requirement already satisfied: setuptools in /opt/conda/lib/python3.7/site-packages (from spacy==2.2.3) (46.0.0.post20200311)
Collecting blis&lt;0.5.0,&gt;=0.4.0
  Downloading blis-0.4.1-cp37-cp37m-manylinux1_x86_64.whl (3.7 MB)
Collecting srsly&lt;1.1.0,&gt;=0.1.0
  Downloading srsly-1.0.2-cp37-cp37m-manylinux1_x86_64.whl (185 kB)
Collecting catalogue&lt;1.1.0,&gt;=0.0.7
  Downloading catalogue-1.0.0-py2.py3-none-any.whl (7.7 kB)
Collecting cymem&lt;2.1.0,&gt;=2.0.2
  Downloading cymem-2.0.3-cp37-cp37m-manylinux1_x86_64.whl (32 kB)
Collecting preshed&lt;3.1.0,&gt;=3.0.2
  Downloading preshed-3.0.2-cp37-cp37m-manylinux1_x86_64.whl (118 kB)
Requirement already satisfied: chardet&lt;3.1.0,&gt;=3.0.2 in /opt/conda/lib/python3.7/site-packages (from requests&lt;3.0.0,&gt;=2.13.0-&gt;spacy==2.2.3) (3.0.4)
Requirement already satisfied: urllib3!=1.25.0,!=1.25.1,&lt;1.26,&gt;=1.21.1 in /opt/conda/lib/python3.7/site-packages (from requests&lt;3.0.0,&gt;=2.13.0-&gt;spacy==2.2.3) (1.25.7)
Requirement already satisfied: idna&lt;2.9,&gt;=2.5 in /opt/conda/lib/python3.7/site-packages (from requests&lt;3.0.0,&gt;=2.13.0-&gt;spacy==2.2.3) (2.8)
Requirement already satisfied: certifi&gt;=2017.4.17 in /opt/conda/lib/python3.7/site-packages (from requests&lt;3.0.0,&gt;=2.13.0-&gt;spacy==2.2.3) (2019.11.28)
Requirement already satisfied: tqdm&lt;5.0.0,&gt;=4.10.0 in /opt/conda/lib/python3.7/site-packages (from thinc&lt;7.4.0,&gt;=7.3.0-&gt;spacy==2.2.3) (4.41.1)
Requirement already satisfied: importlib-metadata&gt;=0.20; python_version &lt; &#34;3.8&#34; in /opt/conda/lib/python3.7/site-packages (from catalogue&lt;1.1.0,&gt;=0.0.7-&gt;spacy==2.2.3) (1.5.0)
Requirement already satisfied: zipp&gt;=0.5 in /opt/conda/lib/python3.7/site-packages (from importlib-metadata&gt;=0.20; python_version &lt; &#34;3.8&#34;-&gt;catalogue&lt;1.1.0,&gt;=0.0.7-&gt;spacy==2.2.3) (3.1.0)
Installing collected packages: wasabi, srsly, murmurhash, plac, blis, cymem, preshed, thinc, catalogue, spacy
Successfully installed blis-0.4.1 catalogue-1.0.0 cymem-2.0.3 murmurhash-1.0.2 plac-1.1.3 preshed-3.0.2 spacy-2.2.3 srsly-1.0.2 thinc-7.3.1 wasabi-0.6.0
Collecting en_core_web_sm==2.2.5
  Downloading https://github.com/explosion/spacy-models/releases/download/en_core_web_sm-2.2.5/en_core_web_sm-2.2.5.tar.gz (12.0 MB)
Requirement already satisfied: spacy&gt;=2.2.2 in /opt/conda/lib/python3.7/site-packages (from en_core_web_sm==2.2.5) (2.2.3)
Requirement already satisfied: wasabi&lt;1.1.0,&gt;=0.4.0 in /opt/conda/lib/python3.7/site-packages (from spacy&gt;=2.2.2-&gt;en_core_web_sm==2.2.5) (0.6.0)
Requirement already satisfied: plac&lt;1.2.0,&gt;=0.9.6 in /opt/conda/lib/python3.7/site-packages (from spacy&gt;=2.2.2-&gt;en_core_web_sm==2.2.5) (1.1.3)
Requirement already satisfied: preshed&lt;3.1.0,&gt;=3.0.2 in /opt/conda/lib/python3.7/site-packages (from spacy&gt;=2.2.2-&gt;en_core_web_sm==2.2.5) (3.0.2)
Requirement already satisfied: requests&lt;3.0.0,&gt;=2.13.0 in /opt/conda/lib/python3.7/site-packages (from spacy&gt;=2.2.2-&gt;en_core_web_sm==2.2.5) (2.22.0)
Requirement already satisfied: numpy&gt;=1.15.0 in /opt/conda/lib/python3.7/site-packages (from spacy&gt;=2.2.2-&gt;en_core_web_sm==2.2.5) (1.18.0)
Requirement already satisfied: blis&lt;0.5.0,&gt;=0.4.0 in /opt/conda/lib/python3.7/site-packages (from spacy&gt;=2.2.2-&gt;en_core_web_sm==2.2.5) (0.4.1)
Requirement already satisfied: srsly&lt;1.1.0,&gt;=0.1.0 in /opt/conda/lib/python3.7/site-packages (from spacy&gt;=2.2.2-&gt;en_core_web_sm==2.2.5) (1.0.2)
Requirement already satisfied: catalogue&lt;1.1.0,&gt;=0.0.7 in /opt/conda/lib/python3.7/site-packages (from spacy&gt;=2.2.2-&gt;en_core_web_sm==2.2.5) (1.0.0)
Requirement already satisfied: murmurhash&lt;1.1.0,&gt;=0.28.0 in /opt/conda/lib/python3.7/site-packages (from spacy&gt;=2.2.2-&gt;en_core_web_sm==2.2.5) (1.0.2)
Requirement already satisfied: cymem&lt;2.1.0,&gt;=2.0.2 in /opt/conda/lib/python3.7/site-packages (from spacy&gt;=2.2.2-&gt;en_core_web_sm==2.2.5) (2.0.3)
Requirement already satisfied: setuptools in /opt/conda/lib/python3.7/site-packages (from spacy&gt;=2.2.2-&gt;en_core_web_sm==2.2.5) (46.0.0.post20200311)
Requirement already satisfied: thinc&lt;7.4.0,&gt;=7.3.0 in /opt/conda/lib/python3.7/site-packages (from spacy&gt;=2.2.2-&gt;en_core_web_sm==2.2.5) (7.3.1)
Requirement already satisfied: chardet&lt;3.1.0,&gt;=3.0.2 in /opt/conda/lib/python3.7/site-packages (from requests&lt;3.0.0,&gt;=2.13.0-&gt;spacy&gt;=2.2.2-&gt;en_core_web_sm==2.2.5) (3.0.4)
Requirement already satisfied: urllib3!=1.25.0,!=1.25.1,&lt;1.26,&gt;=1.21.1 in /opt/conda/lib/python3.7/site-packages (from requests&lt;3.0.0,&gt;=2.13.0-&gt;spacy&gt;=2.2.2-&gt;en_core_web_sm==2.2.5) (1.25.7)
Requirement already satisfied: idna&lt;2.9,&gt;=2.5 in /opt/conda/lib/python3.7/site-packages (from requests&lt;3.0.0,&gt;=2.13.0-&gt;spacy&gt;=2.2.2-&gt;en_core_web_sm==2.2.5) (2.8)
Requirement already satisfied: certifi&gt;=2017.4.17 in /opt/conda/lib/python3.7/site-packages (from requests&lt;3.0.0,&gt;=2.13.0-&gt;spacy&gt;=2.2.2-&gt;en_core_web_sm==2.2.5) (2019.11.28)
Requirement already satisfied: importlib-metadata&gt;=0.20; python_version &lt; &#34;3.8&#34; in /opt/conda/lib/python3.7/site-packages (from catalogue&lt;1.1.0,&gt;=0.0.7-&gt;spacy&gt;=2.2.2-&gt;en_core_web_sm==2.2.5) (1.5.0)
Requirement already satisfied: tqdm&lt;5.0.0,&gt;=4.10.0 in /opt/conda/lib/python3.7/site-packages (from thinc&lt;7.4.0,&gt;=7.3.0-&gt;spacy&gt;=2.2.2-&gt;en_core_web_sm==2.2.5) (4.41.1)
Requirement already satisfied: zipp&gt;=0.5 in /opt/conda/lib/python3.7/site-packages (from importlib-metadata&gt;=0.20; python_version &lt; &#34;3.8&#34;-&gt;catalogue&lt;1.1.0,&gt;=0.0.7-&gt;spacy&gt;=2.2.2-&gt;en_core_web_sm==2.2.5) (3.1.0)
Building wheels for collected packages: en-core-web-sm
  Building wheel for en-core-web-sm (setup.py): started
  Building wheel for en-core-web-sm (setup.py): finished with status &#39;done&#39;
  Created wheel for en-core-web-sm: filename=en_core_web_sm-2.2.5-py3-none-any.whl size=12011738 sha256=59185a5bcd2878bb24549a0a7ab608ff95da9caa976915c5034f7fccf345ddcb
  Stored in directory: /home/jovyan/.cache/pip/wheels/51/19/da/a3885266a3c241aff0ad2eb674ae058fd34a4870fef1c0a5a0
Successfully built en-core-web-sm
Installing collected packages: en-core-web-sm
Successfully installed en-core-web-sm-2.2.5

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="replacement_f" class="doc_header"><code>replacement_f</code><a href="https://github.com/kikejimenez/let_me_answer_for_you/tree/master/let_me_answer_for_you/dialog_system.py#L41" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>replacement_f</code>(<strong><code>model_config</code></strong>, <strong>**<code>args</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="gen_faq_config_file" class="doc_header"><code>gen_faq_config_file</code><a href="https://github.com/kikejimenez/let_me_answer_for_you/tree/master/let_me_answer_for_you/dialog_system.py#L48" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>gen_faq_config_file</code>(<strong>**<code>args</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">FAQ_DATA_FILE</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="n">popen</span><span class="p">(</span><span class="s1">&#39;dirname $PWD&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="s1">&#39;data/faq_data.csv&#39;</span>
<span class="p">)</span>
<span class="n">gen_faq_config_file</span><span class="p">(</span><span class="n">dataset_reader</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;data_path&#39;</span><span class="p">:</span> <span class="n">FAQ_DATA_FILE</span><span class="p">})</span>
<span class="k">assert</span> <span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">faq_data_file</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="load_qa_models" class="doc_header"><code>load_qa_models</code><a href="https://github.com/kikejimenez/let_me_answer_for_you/tree/master/let_me_answer_for_you/dialog_system.py#L60" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>load_qa_models</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">qa_models</span> <span class="o">=</span> <span class="n">load_qa_models</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>08:33:31 DEBUG:Starting new HTTP connection (1): files.deeppavlov.ai:80
08:33:32 DEBUG:http://files.deeppavlov.ai:80 &#34;GET /embeddings/wiki-news-300d-1M-char.vec.md5 HTTP/1.1&#34; 200 61
2020-06-10 20:33:32.395 INFO in &#39;deeppavlov.download&#39;[&#39;download&#39;] at line 117: Skipped http://files.deeppavlov.ai/embeddings/wiki-news-300d-1M-char.vec download because of matching hashes
08:33:32 INFO:Skipped http://files.deeppavlov.ai/embeddings/wiki-news-300d-1M-char.vec download because of matching hashes
08:33:32 DEBUG:Starting new HTTP connection (1): files.deeppavlov.ai:80
08:33:32 DEBUG:http://files.deeppavlov.ai:80 &#34;GET /deeppavlov_data/squad_model_1.4_cpu_compatible.tar.gz.md5 HTTP/1.1&#34; 200 389
2020-06-10 20:33:33.613 INFO in &#39;deeppavlov.download&#39;[&#39;download&#39;] at line 117: Skipped http://files.deeppavlov.ai/deeppavlov_data/squad_model_1.4_cpu_compatible.tar.gz download because of matching hashes
08:33:33 INFO:Skipped http://files.deeppavlov.ai/deeppavlov_data/squad_model_1.4_cpu_compatible.tar.gz download because of matching hashes
08:33:33 DEBUG:Starting new HTTP connection (1): files.deeppavlov.ai:80
08:33:34 DEBUG:http://files.deeppavlov.ai:80 &#34;GET /embeddings/wiki-news-300d-1M.vec.md5 HTTP/1.1&#34; 200 56
2020-06-10 20:33:37.635 INFO in &#39;deeppavlov.download&#39;[&#39;download&#39;] at line 117: Skipped http://files.deeppavlov.ai/embeddings/wiki-news-300d-1M.vec download because of matching hashes
08:33:37 INFO:Skipped http://files.deeppavlov.ai/embeddings/wiki-news-300d-1M.vec download because of matching hashes
2020-06-10 20:33:37.637 INFO in &#39;deeppavlov.models.preprocessors.squad_preprocessor&#39;[&#39;squad_preprocessor&#39;] at line 310: SquadVocabEmbedder: loading saved tokens vocab from /home/jovyan/.deeppavlov/models/squad_model/emb/vocab_embedder.pckl
08:33:37 INFO:SquadVocabEmbedder: loading saved tokens vocab from /home/jovyan/.deeppavlov/models/squad_model/emb/vocab_embedder.pckl
2020-06-10 20:33:37.928 INFO in &#39;deeppavlov.models.preprocessors.squad_preprocessor&#39;[&#39;squad_preprocessor&#39;] at line 310: SquadVocabEmbedder: loading saved chars vocab from /home/jovyan/.deeppavlov/models/squad_model/emb/char_vocab_embedder.pckl
08:33:37 INFO:SquadVocabEmbedder: loading saved chars vocab from /home/jovyan/.deeppavlov/models/squad_model/emb/char_vocab_embedder.pckl
2020-06-10 20:33:38.497 INFO in &#39;deeppavlov.core.layers.tf_layers&#39;[&#39;tf_layers&#39;] at line 615: 
Warning! tf.contrib.cudnn_rnn.CudnnCompatibleGRUCell is used. It is okay for inference mode, but if you train your model with this cell it could NOT be used with tf.contrib.cudnn_rnn.CudnnGRUCell later. 
08:33:38 INFO:
Warning! tf.contrib.cudnn_rnn.CudnnCompatibleGRUCell is used. It is okay for inference mode, but if you train your model with this cell it could NOT be used with tf.contrib.cudnn_rnn.CudnnGRUCell later. 
2020-06-10 20:33:38.637 INFO in &#39;deeppavlov.core.layers.tf_layers&#39;[&#39;tf_layers&#39;] at line 615: 
Warning! tf.contrib.cudnn_rnn.CudnnCompatibleGRUCell is used. It is okay for inference mode, but if you train your model with this cell it could NOT be used with tf.contrib.cudnn_rnn.CudnnGRUCell later. 
08:33:38 INFO:
Warning! tf.contrib.cudnn_rnn.CudnnCompatibleGRUCell is used. It is okay for inference mode, but if you train your model with this cell it could NOT be used with tf.contrib.cudnn_rnn.CudnnGRUCell later. 
2020-06-10 20:33:38.787 INFO in &#39;deeppavlov.core.layers.tf_layers&#39;[&#39;tf_layers&#39;] at line 615: 
Warning! tf.contrib.cudnn_rnn.CudnnCompatibleGRUCell is used. It is okay for inference mode, but if you train your model with this cell it could NOT be used with tf.contrib.cudnn_rnn.CudnnGRUCell later. 
08:33:38 INFO:
Warning! tf.contrib.cudnn_rnn.CudnnCompatibleGRUCell is used. It is okay for inference mode, but if you train your model with this cell it could NOT be used with tf.contrib.cudnn_rnn.CudnnGRUCell later. 
2020-06-10 20:33:38.902 INFO in &#39;deeppavlov.core.layers.tf_layers&#39;[&#39;tf_layers&#39;] at line 615: 
Warning! tf.contrib.cudnn_rnn.CudnnCompatibleGRUCell is used. It is okay for inference mode, but if you train your model with this cell it could NOT be used with tf.contrib.cudnn_rnn.CudnnGRUCell later. 
08:33:38 INFO:
Warning! tf.contrib.cudnn_rnn.CudnnCompatibleGRUCell is used. It is okay for inference mode, but if you train your model with this cell it could NOT be used with tf.contrib.cudnn_rnn.CudnnGRUCell later. 
2020-06-10 20:33:53.56 INFO in &#39;deeppavlov.core.models.tf_model&#39;[&#39;tf_model&#39;] at line 51: [loading model from /home/jovyan/.deeppavlov/models/squad_model/model]
08:33:53 INFO:[loading model from /home/jovyan/.deeppavlov/models/squad_model/model]
08:33:53 INFO:Restoring parameters from /home/jovyan/.deeppavlov/models/squad_model/model
08:33:54 DEBUG:Starting new HTTP connection (1): files.deeppavlov.ai:80
08:33:54 DEBUG:http://files.deeppavlov.ai:80 &#34;GET /deeppavlov_data/squad_bert.tar.gz.md5 HTTP/1.1&#34; 200 184
2020-06-10 20:33:55.170 INFO in &#39;deeppavlov.download&#39;[&#39;download&#39;] at line 117: Skipped http://files.deeppavlov.ai/deeppavlov_data/squad_bert.tar.gz download because of matching hashes
08:33:55 INFO:Skipped http://files.deeppavlov.ai/deeppavlov_data/squad_bert.tar.gz download because of matching hashes
08:33:55 DEBUG:Starting new HTTP connection (1): files.deeppavlov.ai:80
08:33:55 DEBUG:http://files.deeppavlov.ai:80 &#34;GET /deeppavlov_data/bert/cased_L-12_H-768_A-12.zip.md5 HTTP/1.1&#34; 200 386
2020-06-10 20:33:56.309 INFO in &#39;deeppavlov.download&#39;[&#39;download&#39;] at line 117: Skipped http://files.deeppavlov.ai/deeppavlov_data/bert/cased_L-12_H-768_A-12.zip download because of matching hashes
08:33:56 INFO:Skipped http://files.deeppavlov.ai/deeppavlov_data/bert/cased_L-12_H-768_A-12.zip download because of matching hashes
2020-06-10 20:34:14.335 INFO in &#39;deeppavlov.core.models.tf_model&#39;[&#39;tf_model&#39;] at line 51: [loading model from /home/jovyan/.deeppavlov/models/squad_bert/model]
08:34:14 INFO:[loading model from /home/jovyan/.deeppavlov/models/squad_bert/model]
08:34:14 INFO:Restoring parameters from /home/jovyan/.deeppavlov/models/squad_bert/model
08:34:15 DEBUG:Starting new HTTP connection (1): files.deeppavlov.ai:80
08:34:16 DEBUG:http://files.deeppavlov.ai:80 &#34;GET /faq/mipt/en_mipt_faq_v4.tar.gz.md5 HTTP/1.1&#34; 200 189
08:34:16 DEBUG:Starting new HTTP connection (1): files.deeppavlov.ai:80
08:34:16 DEBUG:http://files.deeppavlov.ai:80 &#34;GET /faq/mipt/en_mipt_faq_v4.tar.gz HTTP/1.1&#34; 200 12276
2020-06-10 20:34:16.774 INFO in &#39;deeppavlov.core.data.utils&#39;[&#39;utils&#39;] at line 80: Downloading from http://files.deeppavlov.ai/faq/mipt/en_mipt_faq_v4.tar.gz to /home/jovyan/.deeppavlov/models/faq/en_mipt_faq_v4.tar.gz
08:34:16 INFO:Downloading from http://files.deeppavlov.ai/faq/mipt/en_mipt_faq_v4.tar.gz to /home/jovyan/.deeppavlov/models/faq/en_mipt_faq_v4.tar.gz
100%|██████████| 12.3k/12.3k [00:00&lt;00:00, 11.5MB/s]
2020-06-10 20:34:16.783 INFO in &#39;deeppavlov.core.data.utils&#39;[&#39;utils&#39;] at line 242: Extracting /home/jovyan/.deeppavlov/models/faq/en_mipt_faq_v4.tar.gz archive into /home/jovyan/.deeppavlov/models/faq/mipt
08:34:16 INFO:Extracting /home/jovyan/.deeppavlov/models/faq/en_mipt_faq_v4.tar.gz archive into /home/jovyan/.deeppavlov/models/faq/mipt
2020-06-10 20:34:17.628 INFO in &#39;deeppavlov.models.sklearn.sklearn_component&#39;[&#39;sklearn_component&#39;] at line 203: Loading model sklearn.feature_extraction.text:TfidfVectorizer from /home/jovyan/.deeppavlov/models/faq/mipt/en_mipt_faq_v4/tfidf.pkl
08:34:17 INFO:Loading model sklearn.feature_extraction.text:TfidfVectorizer from /home/jovyan/.deeppavlov/models/faq/mipt/en_mipt_faq_v4/tfidf.pkl
2020-06-10 20:34:17.629 INFO in &#39;deeppavlov.models.sklearn.sklearn_component&#39;[&#39;sklearn_component&#39;] at line 210: Model sklearn.feature_extraction.textTfidfVectorizer loaded  with parameters
08:34:17 INFO:Model sklearn.feature_extraction.textTfidfVectorizer loaded  with parameters
2020-06-10 20:34:17.630 WARNING in &#39;deeppavlov.models.sklearn.sklearn_component&#39;[&#39;sklearn_component&#39;] at line 216: Fitting of loaded model can not be continued. Model can be fitted from scratch.If one needs to continue fitting, please, look at `warm_start` parameter
08:34:17 WARNING:Fitting of loaded model can not be continued. Model can be fitted from scratch.If one needs to continue fitting, please, look at `warm_start` parameter
2020-06-10 20:34:17.674 INFO in &#39;deeppavlov.models.sklearn.sklearn_component&#39;[&#39;sklearn_component&#39;] at line 109: Fitting model sklearn.feature_extraction.textTfidfVectorizer
08:34:17 INFO:Fitting model sklearn.feature_extraction.textTfidfVectorizer
2020-06-10 20:34:17.678 INFO in &#39;deeppavlov.models.sklearn.sklearn_component&#39;[&#39;sklearn_component&#39;] at line 241: Saving model to /home/jovyan/.deeppavlov/models/faq/mipt/en_mipt_faq_v4/tfidf.pkl
08:34:17 INFO:Saving model to /home/jovyan/.deeppavlov/models/faq/mipt/en_mipt_faq_v4/tfidf.pkl
2020-06-10 20:34:17.682 INFO in &#39;deeppavlov.core.data.simple_vocab&#39;[&#39;simple_vocab&#39;] at line 115: [loading vocabulary from /home/jovyan/.deeppavlov/models/faq/mipt/en_mipt_faq_v4/en_mipt_answers.dict]
08:34:17 INFO:[loading vocabulary from /home/jovyan/.deeppavlov/models/faq/mipt/en_mipt_faq_v4/en_mipt_answers.dict]
2020-06-10 20:34:17.683 INFO in &#39;deeppavlov.core.data.simple_vocab&#39;[&#39;simple_vocab&#39;] at line 101: [saving vocabulary to /home/jovyan/.deeppavlov/models/faq/mipt/en_mipt_faq_v4/en_mipt_answers.dict]
08:34:17 INFO:[saving vocabulary to /home/jovyan/.deeppavlov/models/faq/mipt/en_mipt_faq_v4/en_mipt_answers.dict]
2020-06-10 20:34:17.686 INFO in &#39;deeppavlov.models.sklearn.sklearn_component&#39;[&#39;sklearn_component&#39;] at line 203: Loading model sklearn.linear_model:LogisticRegression from /home/jovyan/.deeppavlov/models/faq/mipt/en_mipt_faq_v4/logreg.pkl
08:34:17 INFO:Loading model sklearn.linear_model:LogisticRegression from /home/jovyan/.deeppavlov/models/faq/mipt/en_mipt_faq_v4/logreg.pkl
2020-06-10 20:34:17.687 INFO in &#39;deeppavlov.models.sklearn.sklearn_component&#39;[&#39;sklearn_component&#39;] at line 210: Model sklearn.linear_model.logisticLogisticRegression loaded  with parameters
08:34:17 INFO:Model sklearn.linear_model.logisticLogisticRegression loaded  with parameters
2020-06-10 20:34:17.688 WARNING in &#39;deeppavlov.models.sklearn.sklearn_component&#39;[&#39;sklearn_component&#39;] at line 216: Fitting of loaded model can not be continued. Model can be fitted from scratch.If one needs to continue fitting, please, look at `warm_start` parameter
08:34:17 WARNING:Fitting of loaded model can not be continued. Model can be fitted from scratch.If one needs to continue fitting, please, look at `warm_start` parameter
2020-06-10 20:34:17.728 INFO in &#39;deeppavlov.models.sklearn.sklearn_component&#39;[&#39;sklearn_component&#39;] at line 109: Fitting model sklearn.linear_model.logisticLogisticRegression
08:34:17 INFO:Fitting model sklearn.linear_model.logisticLogisticRegression
/opt/conda/lib/python3.7/site-packages/sklearn/linear_model/logistic.py:432: FutureWarning: Default solver will be changed to &#39;lbfgs&#39; in 0.22. Specify a solver to silence this warning.
  FutureWarning)
/opt/conda/lib/python3.7/site-packages/sklearn/linear_model/logistic.py:469: FutureWarning: Default multi_class will be changed to &#39;auto&#39; in 0.22. Specify the multi_class option to silence this warning.
  &#34;this warning.&#34;, FutureWarning)
2020-06-10 20:34:17.738 INFO in &#39;deeppavlov.models.sklearn.sklearn_component&#39;[&#39;sklearn_component&#39;] at line 241: Saving model to /home/jovyan/.deeppavlov/models/faq/mipt/en_mipt_faq_v4/logreg.pkl
08:34:17 INFO:Saving model to /home/jovyan/.deeppavlov/models/faq/mipt/en_mipt_faq_v4/logreg.pkl
2020-06-10 20:34:18.580 INFO in &#39;deeppavlov.models.sklearn.sklearn_component&#39;[&#39;sklearn_component&#39;] at line 203: Loading model sklearn.feature_extraction.text:TfidfVectorizer from /home/jovyan/.deeppavlov/models/faq/mipt/en_mipt_faq_v4/tfidf.pkl
08:34:18 INFO:Loading model sklearn.feature_extraction.text:TfidfVectorizer from /home/jovyan/.deeppavlov/models/faq/mipt/en_mipt_faq_v4/tfidf.pkl
2020-06-10 20:34:18.583 INFO in &#39;deeppavlov.models.sklearn.sklearn_component&#39;[&#39;sklearn_component&#39;] at line 210: Model sklearn.feature_extraction.textTfidfVectorizer loaded  with parameters
08:34:18 INFO:Model sklearn.feature_extraction.textTfidfVectorizer loaded  with parameters
2020-06-10 20:34:18.587 WARNING in &#39;deeppavlov.models.sklearn.sklearn_component&#39;[&#39;sklearn_component&#39;] at line 216: Fitting of loaded model can not be continued. Model can be fitted from scratch.If one needs to continue fitting, please, look at `warm_start` parameter
08:34:18 WARNING:Fitting of loaded model can not be continued. Model can be fitted from scratch.If one needs to continue fitting, please, look at `warm_start` parameter
2020-06-10 20:34:18.594 INFO in &#39;deeppavlov.core.data.simple_vocab&#39;[&#39;simple_vocab&#39;] at line 115: [loading vocabulary from /home/jovyan/.deeppavlov/models/faq/mipt/en_mipt_faq_v4/en_mipt_answers.dict]
08:34:18 INFO:[loading vocabulary from /home/jovyan/.deeppavlov/models/faq/mipt/en_mipt_faq_v4/en_mipt_answers.dict]
2020-06-10 20:34:18.597 INFO in &#39;deeppavlov.models.sklearn.sklearn_component&#39;[&#39;sklearn_component&#39;] at line 203: Loading model sklearn.linear_model:LogisticRegression from /home/jovyan/.deeppavlov/models/faq/mipt/en_mipt_faq_v4/logreg.pkl
08:34:18 INFO:Loading model sklearn.linear_model:LogisticRegression from /home/jovyan/.deeppavlov/models/faq/mipt/en_mipt_faq_v4/logreg.pkl
2020-06-10 20:34:18.599 INFO in &#39;deeppavlov.models.sklearn.sklearn_component&#39;[&#39;sklearn_component&#39;] at line 210: Model sklearn.linear_model.logisticLogisticRegression loaded  with parameters
08:34:18 INFO:Model sklearn.linear_model.logisticLogisticRegression loaded  with parameters
2020-06-10 20:34:18.600 WARNING in &#39;deeppavlov.models.sklearn.sklearn_component&#39;[&#39;sklearn_component&#39;] at line 216: Fitting of loaded model can not be continued. Model can be fitted from scratch.If one needs to continue fitting, please, look at `warm_start` parameter
08:34:18 WARNING:Fitting of loaded model can not be continued. Model can be fitted from scratch.If one needs to continue fitting, please, look at `warm_start` parameter
2020-06-10 20:34:19.405 INFO in &#39;deeppavlov.models.sklearn.sklearn_component&#39;[&#39;sklearn_component&#39;] at line 203: Loading model sklearn.feature_extraction.text:TfidfVectorizer from /home/jovyan/.deeppavlov/models/faq/mipt/en_mipt_faq_v4/tfidf.pkl
08:34:19 INFO:Loading model sklearn.feature_extraction.text:TfidfVectorizer from /home/jovyan/.deeppavlov/models/faq/mipt/en_mipt_faq_v4/tfidf.pkl
2020-06-10 20:34:19.407 INFO in &#39;deeppavlov.models.sklearn.sklearn_component&#39;[&#39;sklearn_component&#39;] at line 210: Model sklearn.feature_extraction.textTfidfVectorizer loaded  with parameters
08:34:19 INFO:Model sklearn.feature_extraction.textTfidfVectorizer loaded  with parameters
2020-06-10 20:34:19.409 WARNING in &#39;deeppavlov.models.sklearn.sklearn_component&#39;[&#39;sklearn_component&#39;] at line 216: Fitting of loaded model can not be continued. Model can be fitted from scratch.If one needs to continue fitting, please, look at `warm_start` parameter
08:34:19 WARNING:Fitting of loaded model can not be continued. Model can be fitted from scratch.If one needs to continue fitting, please, look at `warm_start` parameter
2020-06-10 20:34:19.414 INFO in &#39;deeppavlov.core.data.simple_vocab&#39;[&#39;simple_vocab&#39;] at line 115: [loading vocabulary from /home/jovyan/.deeppavlov/models/faq/mipt/en_mipt_faq_v4/en_mipt_answers.dict]
08:34:19 INFO:[loading vocabulary from /home/jovyan/.deeppavlov/models/faq/mipt/en_mipt_faq_v4/en_mipt_answers.dict]
2020-06-10 20:34:19.418 INFO in &#39;deeppavlov.models.sklearn.sklearn_component&#39;[&#39;sklearn_component&#39;] at line 203: Loading model sklearn.linear_model:LogisticRegression from /home/jovyan/.deeppavlov/models/faq/mipt/en_mipt_faq_v4/logreg.pkl
08:34:19 INFO:Loading model sklearn.linear_model:LogisticRegression from /home/jovyan/.deeppavlov/models/faq/mipt/en_mipt_faq_v4/logreg.pkl
2020-06-10 20:34:19.420 INFO in &#39;deeppavlov.models.sklearn.sklearn_component&#39;[&#39;sklearn_component&#39;] at line 210: Model sklearn.linear_model.logisticLogisticRegression loaded  with parameters
08:34:19 INFO:Model sklearn.linear_model.logisticLogisticRegression loaded  with parameters
2020-06-10 20:34:19.421 WARNING in &#39;deeppavlov.models.sklearn.sklearn_component&#39;[&#39;sklearn_component&#39;] at line 216: Fitting of loaded model can not be continued. Model can be fitted from scratch.If one needs to continue fitting, please, look at `warm_start` parameter
08:34:19 WARNING:Fitting of loaded model can not be continued. Model can be fitted from scratch.If one needs to continue fitting, please, look at `warm_start` parameter
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="select_squad_responses" class="doc_header"><code>select_squad_responses</code><a href="https://github.com/kikejimenez/let_me_answer_for_you/tree/master/let_me_answer_for_you/dialog_system.py#L76" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>select_squad_responses</code>(<strong><code>contexts</code></strong>, <strong><code>squad_model</code></strong>, <strong><code>question</code></strong>, <strong><code>num_returned_values</code></strong>=<em><code>1</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="select_faq_responses" class="doc_header"><code>select_faq_responses</code><a href="https://github.com/kikejimenez/let_me_answer_for_you/tree/master/let_me_answer_for_you/dialog_system.py#L88" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>select_faq_responses</code>(<strong><code>faq_model</code></strong>, <strong><code>question</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="format_responses" class="doc_header"><code>format_responses</code><a href="https://github.com/kikejimenez/let_me_answer_for_you/tree/master/let_me_answer_for_you/dialog_system.py#L92" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>format_responses</code>(<strong><code>question</code></strong>, <strong><code>responses</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_responses" class="doc_header"><code>get_responses</code><a href="https://github.com/kikejimenez/let_me_answer_for_you/tree/master/let_me_answer_for_you/dialog_system.py#L99" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_responses</code>(<strong><code>contexts</code></strong>, <strong><code>question</code></strong>, <strong><code>qa_models</code></strong>, <strong><code>num_returned_values_per_squad_model</code></strong>=<em><code>1</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#tests</span>
<span class="n">example_contexts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s1">&#39;context&#39;</span><span class="p">:</span>
            <span class="p">[</span>
                <span class="s1">&#39;Intekglobal has its headquarters located in TJ&#39;</span><span class="p">,</span>
                <span class="s1">&#39;In Intekglobal we care about you&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Intekglobal is in the north of mexico&#39;</span>
            <span class="p">]</span>
    <span class="p">},</span>
<span class="p">)</span>

<span class="k">assert</span> <span class="n">select_squad_responses</span><span class="p">(</span>
    <span class="n">contexts</span><span class="o">=</span><span class="n">example_contexts</span><span class="p">,</span>
    <span class="n">squad_model</span><span class="o">=</span><span class="n">qa_models</span><span class="p">[</span><span class="s1">&#39;squad&#39;</span><span class="p">][</span><span class="s1">&#39;bert&#39;</span><span class="p">],</span>
    <span class="n">question</span><span class="o">=</span><span class="s1">&#39;Where is Intekglobal located?&#39;</span>
<span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;north of mexico&#39;</span><span class="p">]</span>

<span class="k">assert</span> <span class="n">select_faq_responses</span><span class="p">(</span>
    <span class="n">question</span><span class="o">=</span><span class="s1">&#39;Is Enrique Jimenez the prettiest person in town?&#39;</span><span class="p">,</span>
    <span class="n">faq_model</span><span class="o">=</span><span class="n">qa_models</span><span class="p">[</span><span class="s1">&#39;faq&#39;</span><span class="p">][</span><span class="s1">&#39;tfidf&#39;</span><span class="p">]</span>
<span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;Yes&#39;</span><span class="p">]</span>


<span class="k">assert</span> <span class="n">get_responses</span><span class="p">(</span><span class="n">example_contexts</span><span class="p">,</span> <span class="s1">&#39;What is Intekglobal?&#39;</span><span class="p">,</span>
                     <span class="n">qa_models</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">What is Intekglobal?:</span>

<span class="s1">0: north of mexico</span>
<span class="s1">1: its headquarters</span>
<span class="s1">2: A person.</span>
<span class="s1">&#39;&#39;&#39;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_input" class="doc_header"><code>get_input</code><a href="https://github.com/kikejimenez/let_me_answer_for_you/tree/master/let_me_answer_for_you/dialog_system.py#L117" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_input</code>(<strong><code>text</code></strong>)</p>
</blockquote>
<p>This redundancy is needed for testing</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="new_answer" class="doc_header"><code>new_answer</code><a href="https://github.com/kikejimenez/let_me_answer_for_you/tree/master/let_me_answer_for_you/dialog_system.py#L122" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>new_answer</code>(<strong><code>question</code></strong>, <strong><code>data</code></strong>, <strong><code>qa_models</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="question_response" class="doc_header"><code>question_response</code><a href="https://github.com/kikejimenez/let_me_answer_for_you/tree/master/let_me_answer_for_you/dialog_system.py#L153" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>question_response</code>(<strong><code>data</code></strong>, <strong><code>qa_models</code></strong>, <strong><code>num_returned_values_per_squad_model</code></strong>=<em><code>1</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">##Test FAQ dialog system</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">from</span> <span class="nn">unittest.mock</span> <span class="kn">import</span> <span class="n">patch</span>
<span class="kn">from</span> <span class="nn">shutil</span> <span class="kn">import</span> <span class="n">copyfile</span>
<span class="n">example_contexts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s1">&#39;context&#39;</span><span class="p">:</span>
            <span class="p">[</span>
                <span class="s1">&#39;Intekglobal has its headquarters located in TJ&#39;</span><span class="p">,</span>
                <span class="s1">&#39;In Intekglobal we care about you&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Enrique Jimenez is one of the smartest minds on the planet&#39;</span>
            <span class="p">]</span>
    <span class="p">},</span>
<span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;context&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;df&#39;</span><span class="p">:</span> <span class="n">example_contexts</span><span class="p">,</span>
        <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="o">...</span>
    <span class="p">},</span>
    <span class="s1">&#39;faq&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;df&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span>
        <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="o">...</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">FAQ_DATA_FILE</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="n">popen</span><span class="p">(</span><span class="s1">&#39;dirname $PWD&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="s1">&#39;data/faq_data.csv&#39;</span>
<span class="p">)</span>

<span class="k">def</span> <span class="nf">copy_data_files</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">tmpdirname</span><span class="p">):</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;context&#39;</span><span class="p">][</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="s1">&#39;tmp_context.csv&#39;</span><span class="p">)</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;faq&#39;</span><span class="p">][</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="s1">&#39;tmp_faq.csv&#39;</span><span class="p">)</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;faq&#39;</span><span class="p">][</span><span class="s1">&#39;df&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">FAQ_DATA_FILE</span><span class="p">)</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;context&#39;</span><span class="p">][</span><span class="s1">&#39;df&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;context&#39;</span><span class="p">][</span><span class="s1">&#39;path&#39;</span><span class="p">])</span>
    <span class="n">copyfile</span><span class="p">(</span><span class="n">FAQ_DATA_FILE</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;faq&#39;</span><span class="p">][</span><span class="s1">&#39;path&#39;</span><span class="p">])</span>


<span class="nd">@patch</span><span class="p">(</span><span class="s1">&#39;__main__.get_input&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_context_response_with_no_updates</span><span class="p">(</span><span class="n">mock_input</span><span class="p">):</span>
    <span class="n">mock_input</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Who is Enrique Jimenez?&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">]</span>

    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdirname</span><span class="p">:</span>
        <span class="n">copy_data_files</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">tmpdirname</span><span class="p">)</span>
        <span class="n">responses</span><span class="p">,</span> <span class="n">status</span> <span class="o">=</span> <span class="n">question_response</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">qa_models</span><span class="p">)</span>
        <span class="k">assert</span> <span class="s1">&#39;no data updates..&#39;</span> <span class="o">==</span> <span class="n">status</span>
        <span class="k">assert</span> <span class="s1">&#39;one of the smartest minds on the planet&#39;</span>  <span class="ow">in</span> <span class="n">responses</span>


<span class="nd">@patch</span><span class="p">(</span><span class="s1">&#39;__main__.train_model&#39;</span><span class="p">)</span>
<span class="nd">@patch</span><span class="p">(</span><span class="s1">&#39;__main__.get_input&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_updating_faq_dataset</span><span class="p">(</span><span class="n">mock_input</span><span class="p">,</span> <span class="n">mock_train_model</span><span class="p">):</span>

    <span class="n">new_answer</span> <span class="o">=</span> <span class="s1">&#39;Intekglobal is one of the best companies in the world&#39;</span>
    <span class="n">mock_input</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;What is Intekglobal?&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="n">new_answer</span><span class="p">]</span>
    <span class="n">qa_model_faq</span> <span class="o">=</span> <span class="n">qa_models</span><span class="p">[</span><span class="s1">&#39;faq&#39;</span><span class="p">][</span><span class="s1">&#39;tfidf&#39;</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>

        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdirname</span><span class="p">:</span>
            <span class="n">copy_data_files</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">tmpdirname</span><span class="p">)</span>

            <span class="k">assert</span> <span class="s1">&#39;FAQ dataset and model updated..&#39;</span> <span class="o">==</span> <span class="n">question_response</span><span class="p">(</span>
                <span class="n">data</span><span class="p">,</span> <span class="n">qa_models</span>
            <span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">updated_faq</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;faq&#39;</span><span class="p">][</span><span class="s1">&#39;path&#39;</span><span class="p">])</span>

            <span class="k">assert</span> <span class="n">updated_faq</span><span class="p">[</span><span class="n">updated_faq</span><span class="p">[</span><span class="s1">&#39;Answer&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">new_answer</span>
                              <span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">qa_models</span><span class="p">[</span><span class="s1">&#39;faq&#39;</span><span class="p">][</span><span class="s1">&#39;tfidf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">qa_model_faq</span>


<span class="n">test_context_response_with_no_updates</span><span class="p">()</span>
<span class="n">test_updating_faq_dataset</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">from</span> <span class="nn">unittest.mock</span> <span class="kn">import</span> <span class="n">patch</span>
<span class="kn">from</span> <span class="nn">shutil</span> <span class="kn">import</span> <span class="n">copyfile</span><span class="p">,</span> <span class="n">copytree</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>


<span class="n">HOME_DIR</span> <span class="o">=</span> <span class="n">popen</span><span class="p">(</span><span class="s1">&#39;echo $HOME&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

<span class="n">example_contexts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s1">&#39;context&#39;</span><span class="p">:</span>
            <span class="p">[</span>
                <span class="s1">&#39;Intekglobal has its headquarters located in TJ&#39;</span><span class="p">,</span>
                <span class="s1">&#39;In Intekglobal we care about you&#39;</span>
            <span class="p">]</span>
    <span class="p">},</span>
<span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;context&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;df&#39;</span><span class="p">:</span> <span class="n">example_contexts</span><span class="p">,</span>
        <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="o">...</span>
    <span class="p">},</span>
    <span class="s1">&#39;faq&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;df&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span>
        <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="o">...</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="n">FAQ_DATA_FILE</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="n">popen</span><span class="p">(</span><span class="s1">&#39;dirname $PWD&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="s1">&#39;data/faq_data.csv&#39;</span>
<span class="p">)</span>

<span class="n">CONTEXT_DATA_FILE</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="n">popen</span><span class="p">(</span><span class="s1">&#39;dirname $PWD&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="s1">&#39;data/context_data.csv&#39;</span>
<span class="p">)</span>


<span class="k">def</span> <span class="nf">copy_data_files</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">tmpdirname</span><span class="p">):</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;context&#39;</span><span class="p">][</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="s1">&#39;tmp_context.csv&#39;</span><span class="p">)</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;faq&#39;</span><span class="p">][</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="s1">&#39;tmp_faq.csv&#39;</span><span class="p">)</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;faq&#39;</span><span class="p">][</span><span class="s1">&#39;df&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">FAQ_DATA_FILE</span><span class="p">)</span>
    <span class="n">copyfile</span><span class="p">(</span><span class="n">CONTEXT_DATA_FILE</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;context&#39;</span><span class="p">][</span><span class="s1">&#39;path&#39;</span><span class="p">])</span>
    <span class="n">copyfile</span><span class="p">(</span><span class="n">FAQ_DATA_FILE</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;faq&#39;</span><span class="p">][</span><span class="s1">&#39;path&#39;</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">modify_configs</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">tmpdirname</span><span class="p">):</span>

    <span class="n">copy_data_files</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">tmpdirname</span><span class="p">)</span>

    <span class="n">tmp_configs_faq</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="s1">&#39;temp_config_faq.json&#39;</span><span class="p">)</span>
    <span class="n">tmp_model_dir</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="s1">&#39;temp_models_dir&#39;</span><span class="p">)</span>

    <span class="n">metadata</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">configs</span><span class="o">.</span><span class="n">faq</span><span class="o">.</span><span class="n">tfidf_logreg_en_faq</span><span class="p">)</span>
                        <span class="p">)[</span><span class="s1">&#39;metadata&#39;</span><span class="p">][</span><span class="s1">&#39;variables&#39;</span><span class="p">]</span>

    <span class="n">models_dir</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;MODELS_PATH&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="s1">&#39;</span><span class="si">{ROOT_PATH}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;ROOT_PATH&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;~&#39;</span><span class="p">,</span> <span class="n">HOME_DIR</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">copytree</span><span class="p">(</span><span class="n">models_dir</span><span class="p">,</span> <span class="n">tmp_model_dir</span><span class="p">)</span>
    <span class="n">copyfile</span><span class="p">(</span><span class="n">configs</span><span class="o">.</span><span class="n">faq</span><span class="o">.</span><span class="n">tfidf_logreg_en_faq</span><span class="p">,</span> <span class="n">tmp_configs_faq</span><span class="p">)</span>

    <span class="n">configs</span><span class="o">.</span><span class="n">faq</span><span class="o">.</span><span class="n">tfidf_logreg_en_faq</span> <span class="o">=</span> <span class="n">tmp_configs_faq</span>

    <span class="n">gen_faq_config_file</span><span class="p">(</span>
        <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;variables&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;MODELS_PATH&#39;</span><span class="p">:</span> <span class="n">tmp_model_dir</span>
        <span class="p">}},</span>
        <span class="n">dataset_reader</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;data_path&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;faq&#39;</span><span class="p">][</span><span class="s1">&#39;path&#39;</span><span class="p">]}</span>
    <span class="p">)</span>
    <span class="c1">#pprint(json.load(open(configs.faq.tfidf_logreg_en_faq)))</span>
    <span class="k">assert</span> <span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">tmp_model_dir</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">configs</span><span class="o">.</span><span class="n">faq</span><span class="o">.</span><span class="n">tfidf_logreg_en_faq</span><span class="p">)</span>


<span class="nd">@patch</span><span class="p">(</span><span class="s1">&#39;__main__.get_input&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_faq_answer_with_updating</span><span class="p">(</span><span class="n">mock_input</span><span class="p">):</span>

    <span class="n">new_answer</span> <span class="o">=</span> <span class="s1">&#39;Intekglobal is one of the best companies in the world&#39;</span>
    <span class="n">question</span> <span class="o">=</span> <span class="s1">&#39;What is Intekglobal?&#39;</span>
    <span class="n">mock_input</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="n">question</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="n">new_answer</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">]</span>

    <span class="n">original_config_file</span> <span class="o">=</span> <span class="n">configs</span><span class="o">.</span><span class="n">faq</span><span class="o">.</span><span class="n">tfidf_logreg_en_faq</span>
    <span class="n">qa_model_faq</span> <span class="o">=</span> <span class="n">qa_models</span><span class="p">[</span><span class="s1">&#39;faq&#39;</span><span class="p">][</span><span class="s1">&#39;tfidf&#39;</span><span class="p">]</span>

    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdirname</span><span class="p">:</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">modify_configs</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">tmpdirname</span><span class="p">)</span>
    
            <span class="n">old_responses</span> <span class="o">=</span> <span class="n">question_response</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">qa_models</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">new_responses</span> <span class="o">=</span> <span class="n">question_response</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">qa_models</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
           
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Old response:</span><span class="se">\n</span><span class="s1"> </span><span class="si">{</span><span class="n">old_responses</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;New response:</span><span class="se">\n</span><span class="si">{</span><span class="n">new_responses</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="n">configs</span><span class="o">.</span><span class="n">faq</span><span class="o">.</span><span class="n">tfidf_logreg_en_faq</span> <span class="o">=</span> <span class="n">original_config_file</span>
            <span class="n">qa_models</span><span class="p">[</span><span class="s1">&#39;faq&#39;</span><span class="p">][</span><span class="s1">&#39;tfidf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">qa_model_faq</span>

        <span class="k">assert</span> <span class="n">new_answer</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">old_responses</span>
        <span class="k">assert</span> <span class="n">new_answer</span> <span class="ow">in</span> <span class="n">new_responses</span>


<span class="n">test_faq_answer_with_updating</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2020-06-10 20:54:12.10 INFO in &#39;deeppavlov.models.sklearn.sklearn_component&#39;[&#39;sklearn_component&#39;] at line 203: Loading model sklearn.feature_extraction.text:TfidfVectorizer from /tmp/tmpi5i7nck2/temp_models_dir/faq/mipt/en_mipt_faq_v4/tfidf.pkl
08:54:12 INFO:Loading model sklearn.feature_extraction.text:TfidfVectorizer from /tmp/tmpi5i7nck2/temp_models_dir/faq/mipt/en_mipt_faq_v4/tfidf.pkl
2020-06-10 20:54:12.12 INFO in &#39;deeppavlov.models.sklearn.sklearn_component&#39;[&#39;sklearn_component&#39;] at line 210: Model sklearn.feature_extraction.textTfidfVectorizer loaded  with parameters
08:54:12 INFO:Model sklearn.feature_extraction.textTfidfVectorizer loaded  with parameters
2020-06-10 20:54:12.13 WARNING in &#39;deeppavlov.models.sklearn.sklearn_component&#39;[&#39;sklearn_component&#39;] at line 216: Fitting of loaded model can not be continued. Model can be fitted from scratch.If one needs to continue fitting, please, look at `warm_start` parameter
08:54:12 WARNING:Fitting of loaded model can not be continued. Model can be fitted from scratch.If one needs to continue fitting, please, look at `warm_start` parameter
2020-06-10 20:54:12.84 INFO in &#39;deeppavlov.models.sklearn.sklearn_component&#39;[&#39;sklearn_component&#39;] at line 109: Fitting model sklearn.feature_extraction.textTfidfVectorizer
08:54:12 INFO:Fitting model sklearn.feature_extraction.textTfidfVectorizer
2020-06-10 20:54:12.89 INFO in &#39;deeppavlov.models.sklearn.sklearn_component&#39;[&#39;sklearn_component&#39;] at line 241: Saving model to /tmp/tmpi5i7nck2/temp_models_dir/faq/mipt/en_mipt_faq_v4/tfidf.pkl
08:54:12 INFO:Saving model to /tmp/tmpi5i7nck2/temp_models_dir/faq/mipt/en_mipt_faq_v4/tfidf.pkl
2020-06-10 20:54:12.147 INFO in &#39;deeppavlov.core.data.simple_vocab&#39;[&#39;simple_vocab&#39;] at line 115: [loading vocabulary from /tmp/tmpi5i7nck2/temp_models_dir/faq/mipt/en_mipt_faq_v4/en_mipt_answers.dict]
08:54:12 INFO:[loading vocabulary from /tmp/tmpi5i7nck2/temp_models_dir/faq/mipt/en_mipt_faq_v4/en_mipt_answers.dict]
2020-06-10 20:54:12.149 INFO in &#39;deeppavlov.core.data.simple_vocab&#39;[&#39;simple_vocab&#39;] at line 101: [saving vocabulary to /tmp/tmpi5i7nck2/temp_models_dir/faq/mipt/en_mipt_faq_v4/en_mipt_answers.dict]
08:54:12 INFO:[saving vocabulary to /tmp/tmpi5i7nck2/temp_models_dir/faq/mipt/en_mipt_faq_v4/en_mipt_answers.dict]
2020-06-10 20:54:12.292 INFO in &#39;deeppavlov.models.sklearn.sklearn_component&#39;[&#39;sklearn_component&#39;] at line 203: Loading model sklearn.linear_model:LogisticRegression from /tmp/tmpi5i7nck2/temp_models_dir/faq/mipt/en_mipt_faq_v4/logreg.pkl
08:54:12 INFO:Loading model sklearn.linear_model:LogisticRegression from /tmp/tmpi5i7nck2/temp_models_dir/faq/mipt/en_mipt_faq_v4/logreg.pkl
2020-06-10 20:54:12.298 INFO in &#39;deeppavlov.models.sklearn.sklearn_component&#39;[&#39;sklearn_component&#39;] at line 210: Model sklearn.linear_model.logisticLogisticRegression loaded  with parameters
08:54:12 INFO:Model sklearn.linear_model.logisticLogisticRegression loaded  with parameters
2020-06-10 20:54:12.303 WARNING in &#39;deeppavlov.models.sklearn.sklearn_component&#39;[&#39;sklearn_component&#39;] at line 216: Fitting of loaded model can not be continued. Model can be fitted from scratch.If one needs to continue fitting, please, look at `warm_start` parameter
08:54:12 WARNING:Fitting of loaded model can not be continued. Model can be fitted from scratch.If one needs to continue fitting, please, look at `warm_start` parameter
2020-06-10 20:54:12.369 INFO in &#39;deeppavlov.models.sklearn.sklearn_component&#39;[&#39;sklearn_component&#39;] at line 109: Fitting model sklearn.linear_model.logisticLogisticRegression
08:54:12 INFO:Fitting model sklearn.linear_model.logisticLogisticRegression
/opt/conda/lib/python3.7/site-packages/sklearn/linear_model/logistic.py:432: FutureWarning: Default solver will be changed to &#39;lbfgs&#39; in 0.22. Specify a solver to silence this warning.
  FutureWarning)
/opt/conda/lib/python3.7/site-packages/sklearn/linear_model/logistic.py:469: FutureWarning: Default multi_class will be changed to &#39;auto&#39; in 0.22. Specify the multi_class option to silence this warning.
  &#34;this warning.&#34;, FutureWarning)
2020-06-10 20:54:12.381 INFO in &#39;deeppavlov.models.sklearn.sklearn_component&#39;[&#39;sklearn_component&#39;] at line 241: Saving model to /tmp/tmpi5i7nck2/temp_models_dir/faq/mipt/en_mipt_faq_v4/logreg.pkl
08:54:12 INFO:Saving model to /tmp/tmpi5i7nck2/temp_models_dir/faq/mipt/en_mipt_faq_v4/logreg.pkl
2020-06-10 20:54:13.135 INFO in &#39;deeppavlov.models.sklearn.sklearn_component&#39;[&#39;sklearn_component&#39;] at line 203: Loading model sklearn.feature_extraction.text:TfidfVectorizer from /tmp/tmpi5i7nck2/temp_models_dir/faq/mipt/en_mipt_faq_v4/tfidf.pkl
08:54:13 INFO:Loading model sklearn.feature_extraction.text:TfidfVectorizer from /tmp/tmpi5i7nck2/temp_models_dir/faq/mipt/en_mipt_faq_v4/tfidf.pkl
2020-06-10 20:54:13.137 INFO in &#39;deeppavlov.models.sklearn.sklearn_component&#39;[&#39;sklearn_component&#39;] at line 210: Model sklearn.feature_extraction.textTfidfVectorizer loaded  with parameters
08:54:13 INFO:Model sklearn.feature_extraction.textTfidfVectorizer loaded  with parameters
2020-06-10 20:54:13.138 WARNING in &#39;deeppavlov.models.sklearn.sklearn_component&#39;[&#39;sklearn_component&#39;] at line 216: Fitting of loaded model can not be continued. Model can be fitted from scratch.If one needs to continue fitting, please, look at `warm_start` parameter
08:54:13 WARNING:Fitting of loaded model can not be continued. Model can be fitted from scratch.If one needs to continue fitting, please, look at `warm_start` parameter
2020-06-10 20:54:13.140 INFO in &#39;deeppavlov.core.data.simple_vocab&#39;[&#39;simple_vocab&#39;] at line 115: [loading vocabulary from /tmp/tmpi5i7nck2/temp_models_dir/faq/mipt/en_mipt_faq_v4/en_mipt_answers.dict]
08:54:13 INFO:[loading vocabulary from /tmp/tmpi5i7nck2/temp_models_dir/faq/mipt/en_mipt_faq_v4/en_mipt_answers.dict]
2020-06-10 20:54:13.142 INFO in &#39;deeppavlov.models.sklearn.sklearn_component&#39;[&#39;sklearn_component&#39;] at line 203: Loading model sklearn.linear_model:LogisticRegression from /tmp/tmpi5i7nck2/temp_models_dir/faq/mipt/en_mipt_faq_v4/logreg.pkl
08:54:13 INFO:Loading model sklearn.linear_model:LogisticRegression from /tmp/tmpi5i7nck2/temp_models_dir/faq/mipt/en_mipt_faq_v4/logreg.pkl
2020-06-10 20:54:13.144 INFO in &#39;deeppavlov.models.sklearn.sklearn_component&#39;[&#39;sklearn_component&#39;] at line 210: Model sklearn.linear_model.logisticLogisticRegression loaded  with parameters
08:54:13 INFO:Model sklearn.linear_model.logisticLogisticRegression loaded  with parameters
2020-06-10 20:54:13.145 WARNING in &#39;deeppavlov.models.sklearn.sklearn_component&#39;[&#39;sklearn_component&#39;] at line 216: Fitting of loaded model can not be continued. Model can be fitted from scratch.If one needs to continue fitting, please, look at `warm_start` parameter
08:54:13 WARNING:Fitting of loaded model can not be continued. Model can be fitted from scratch.If one needs to continue fitting, please, look at `warm_start` parameter
2020-06-10 20:54:14.131 INFO in &#39;deeppavlov.models.sklearn.sklearn_component&#39;[&#39;sklearn_component&#39;] at line 203: Loading model sklearn.feature_extraction.text:TfidfVectorizer from /tmp/tmpi5i7nck2/temp_models_dir/faq/mipt/en_mipt_faq_v4/tfidf.pkl
08:54:14 INFO:Loading model sklearn.feature_extraction.text:TfidfVectorizer from /tmp/tmpi5i7nck2/temp_models_dir/faq/mipt/en_mipt_faq_v4/tfidf.pkl
2020-06-10 20:54:14.133 INFO in &#39;deeppavlov.models.sklearn.sklearn_component&#39;[&#39;sklearn_component&#39;] at line 210: Model sklearn.feature_extraction.textTfidfVectorizer loaded  with parameters
08:54:14 INFO:Model sklearn.feature_extraction.textTfidfVectorizer loaded  with parameters
2020-06-10 20:54:14.135 WARNING in &#39;deeppavlov.models.sklearn.sklearn_component&#39;[&#39;sklearn_component&#39;] at line 216: Fitting of loaded model can not be continued. Model can be fitted from scratch.If one needs to continue fitting, please, look at `warm_start` parameter
08:54:14 WARNING:Fitting of loaded model can not be continued. Model can be fitted from scratch.If one needs to continue fitting, please, look at `warm_start` parameter
2020-06-10 20:54:14.142 INFO in &#39;deeppavlov.core.data.simple_vocab&#39;[&#39;simple_vocab&#39;] at line 115: [loading vocabulary from /tmp/tmpi5i7nck2/temp_models_dir/faq/mipt/en_mipt_faq_v4/en_mipt_answers.dict]
08:54:14 INFO:[loading vocabulary from /tmp/tmpi5i7nck2/temp_models_dir/faq/mipt/en_mipt_faq_v4/en_mipt_answers.dict]
2020-06-10 20:54:14.145 INFO in &#39;deeppavlov.models.sklearn.sklearn_component&#39;[&#39;sklearn_component&#39;] at line 203: Loading model sklearn.linear_model:LogisticRegression from /tmp/tmpi5i7nck2/temp_models_dir/faq/mipt/en_mipt_faq_v4/logreg.pkl
08:54:14 INFO:Loading model sklearn.linear_model:LogisticRegression from /tmp/tmpi5i7nck2/temp_models_dir/faq/mipt/en_mipt_faq_v4/logreg.pkl
2020-06-10 20:54:14.147 INFO in &#39;deeppavlov.models.sklearn.sklearn_component&#39;[&#39;sklearn_component&#39;] at line 210: Model sklearn.linear_model.logisticLogisticRegression loaded  with parameters
08:54:14 INFO:Model sklearn.linear_model.logisticLogisticRegression loaded  with parameters
2020-06-10 20:54:14.148 WARNING in &#39;deeppavlov.models.sklearn.sklearn_component&#39;[&#39;sklearn_component&#39;] at line 216: Fitting of loaded model can not be continued. Model can be fitted from scratch.If one needs to continue fitting, please, look at `warm_start` parameter
08:54:14 WARNING:Fitting of loaded model can not be continued. Model can be fitted from scratch.If one needs to continue fitting, please, look at `warm_start` parameter
08:54:16 INFO:Old response:
 What is Intekglobal?:

0: care about you
1: its headquarters
2: A person.

08:54:16 INFO:New response:
What is Intekglobal?:

0: care about you
1: its headquarters
2: Intekglobal is one of the best companies in the world

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">##Test Context Dialog System</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">from</span> <span class="nn">unittest.mock</span> <span class="kn">import</span> <span class="n">patch</span>
<span class="kn">from</span> <span class="nn">shutil</span> <span class="kn">import</span> <span class="n">copyfile</span><span class="p">,</span> <span class="n">copytree</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>

<span class="n">example_contexts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s1">&#39;topic&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Headquarters&#39;</span><span class="p">,</span> <span class="s1">&#39;Mision&#39;</span><span class="p">],</span>
        <span class="s1">&#39;context&#39;</span><span class="p">:</span>
            <span class="p">[</span>
                <span class="s1">&#39;Intekglobal has its headquarters located in TJ&#39;</span><span class="p">,</span>
                <span class="s1">&#39;In Intekglobal we care about you&#39;</span>
            <span class="p">]</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;context&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;df&#39;</span><span class="p">:</span> <span class="n">example_contexts</span><span class="p">,</span>
        <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="o">...</span>
    <span class="p">},</span>
    <span class="s1">&#39;faq&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;df&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span>
        <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="o">...</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="n">FAQ_DATA_FILE</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="n">popen</span><span class="p">(</span><span class="s1">&#39;dirname $PWD&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="s1">&#39;data/faq_data.csv&#39;</span>
<span class="p">)</span>

<span class="n">CONTEXT_DATA_FILE</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="n">popen</span><span class="p">(</span><span class="s1">&#39;dirname $PWD&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="s1">&#39;data/context_data.csv&#39;</span>
<span class="p">)</span>


<span class="k">def</span> <span class="nf">copy_data_files</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">tmpdirname</span><span class="p">):</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;context&#39;</span><span class="p">][</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="s1">&#39;tmp_context.csv&#39;</span><span class="p">)</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;faq&#39;</span><span class="p">][</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="s1">&#39;tmp_faq.csv&#39;</span><span class="p">)</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;faq&#39;</span><span class="p">][</span><span class="s1">&#39;df&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">FAQ_DATA_FILE</span><span class="p">)</span>
    <span class="n">copyfile</span><span class="p">(</span><span class="n">CONTEXT_DATA_FILE</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;context&#39;</span><span class="p">][</span><span class="s1">&#39;path&#39;</span><span class="p">])</span>
    <span class="n">copyfile</span><span class="p">(</span><span class="n">FAQ_DATA_FILE</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;faq&#39;</span><span class="p">][</span><span class="s1">&#39;path&#39;</span><span class="p">])</span>


<span class="nd">@patch</span><span class="p">(</span><span class="s1">&#39;__main__.get_input&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_context_new_answer</span><span class="p">(</span><span class="n">mock_input</span><span class="p">):</span>

    <span class="n">question</span> <span class="o">=</span> <span class="s1">&#39;What is a Chatbot?&#39;</span>
    <span class="n">new_topic</span> <span class="o">=</span> <span class="s1">&#39;AI Tool &amp; Chatbot Development&#39;</span>
    <span class="n">new_context</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>

<span class="s1">A chatbot is an important tool for simulating intelligent conversations with humans.</span>
<span class="s1">Intekglobal chatbots efficiently live message on platforms such as Facebook Messenger, </span>
<span class="s1">Slack, and Telegram. Assisting consumers with a variety of purposes and industries. </span>

<span class="s1">But chatbots are more than just a cool technology advancement. They actually transform the user experience.</span>
<span class="s1">People want simple and convenient interactions with interface and products.</span>

<span class="s1">&#39;&#39;&#39;</span>

    <span class="n">mock_input</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">question</span><span class="p">,</span> <span class="s1">&#39;YES&#39;</span><span class="p">,</span> <span class="s1">&#39;yes&#39;</span><span class="p">,</span> <span class="n">new_topic</span><span class="p">,</span> <span class="n">new_context</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span>
    <span class="p">]</span>

    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdirname</span><span class="p">:</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="n">copy_data_files</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">tmpdirname</span><span class="p">)</span>

            <span class="n">old_responses</span> <span class="o">=</span> <span class="n">question_response</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">qa_models</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Old response:</span><span class="se">\n</span><span class="s1"> </span><span class="si">{</span><span class="n">old_responses</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">new_responses</span> <span class="o">=</span> <span class="n">question_response</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">qa_models</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;New response:</span><span class="se">\n</span><span class="si">{</span><span class="n">new_responses</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39; Test finished&#39;</span><span class="p">)</span>

        <span class="n">updated_context</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;context&#39;</span><span class="p">][</span><span class="s1">&#39;path&#39;</span><span class="p">])</span>

        <span class="k">assert</span> <span class="n">updated_context</span><span class="p">[</span><span class="n">updated_context</span><span class="p">[</span><span class="s1">&#39;context&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">new_context</span>
                              <span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>

        <span class="k">assert</span> <span class="n">updated_context</span><span class="p">[</span><span class="n">updated_context</span><span class="p">[</span><span class="s1">&#39;topic&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">new_topic</span>
                              <span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="k">assert</span> <span class="s1">&#39;an important tool for simulating intelligent conversations with humans&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">old_responses</span>
        <span class="k">assert</span> <span class="s1">&#39;an important tool for simulating intelligent conversations with humans&#39;</span> <span class="ow">in</span> <span class="n">new_responses</span>


<span class="n">test_context_new_answer</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>08:54:34 INFO:Old response:
 What is a Chatbot?:

0: Intekglobal we care about you
1: Intekglobal
2: A person.

08:54:37 INFO:New response:
What is a Chatbot?:

0: A person.
1: an important tool for simulating intelligent conversations with humans

08:54:37 INFO: Test finished
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="dialog_system" class="doc_header"><code>dialog_system</code><a href="https://github.com/kikejimenez/let_me_answer_for_you/tree/master/let_me_answer_for_you/dialog_system.py#L163" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>dialog_system</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># test main()</span>

<span class="kn">from</span> <span class="nn">unittest.mock</span> <span class="kn">import</span> <span class="n">patch</span>

<span class="nd">@patch</span><span class="p">(</span><span class="s1">&#39;__main__.run_shell_installs&#39;</span><span class="p">)</span>
<span class="nd">@patch</span><span class="p">(</span><span class="s1">&#39;__main__.load_qa_models&#39;</span><span class="p">)</span>
<span class="nd">@patch</span><span class="p">(</span><span class="s1">&#39;__main__.pd.read_csv&#39;</span><span class="p">)</span>
<span class="nd">@patch</span><span class="p">(</span><span class="s1">&#39;__main__.question_response&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_main_keyboard_interrupt</span><span class="p">(</span>
    <span class="n">mock_question_response</span><span class="p">,</span>
    <span class="n">mock_pd_read_csv</span><span class="p">,</span>
    <span class="n">mock_load_qa_models</span><span class="p">,</span>
    <span class="n">mock_run_shell_installs</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">mock_question_response</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span>
        <span class="ne">KeyboardInterrupt</span><span class="p">(),</span> <span class="ne">EOFError</span><span class="p">(),</span>
        <span class="ne">SystemExit</span><span class="p">()</span>
    <span class="p">]</span>
    <span class="k">assert</span> <span class="s1">&#39;Goodbye!&#39;</span> <span class="o">==</span> <span class="n">dialog_system</span><span class="p">()</span>
    <span class="k">assert</span> <span class="s1">&#39;Goodbye!&#39;</span> <span class="o">==</span> <span class="n">dialog_system</span><span class="p">()</span>
    <span class="k">assert</span> <span class="s1">&#39;Goodbye!&#39;</span> <span class="o">==</span> <span class="n">dialog_system</span><span class="p">()</span>


<span class="n">test_main_keyboard_interrupt</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>09:01:46 DEBUG:Goodbye!
09:01:46 DEBUG:Goodbye!
09:01:46 DEBUG:Goodbye!
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

