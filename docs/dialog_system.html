---

title: Dialog System 

keywords: fastai
sidebar: home_sidebar

summary: "Class that implements the `question_response`, `new_question_answer` and `new_context` methods"
description: "Class that implements the `question_response`, `new_question_answer` and `new_context` methods"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/02_dialog_system.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="DialogSystem" class="doc_header"><code>class</code> <code>DialogSystem</code><a href="https://github.com/kikejimenez/let_me_answer_for_you/tree/master/let_me_answer_for_you/dialog_system.py#L26" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>DialogSystem</code>(<strong><code>context_data_file</code></strong>=<em><code>None</code></em>, <strong><code>faq_data_file</code></strong>=<em><code>None</code></em>, <strong><code>configs_faq</code></strong>=<em><code>None</code></em>, <strong><code>download_models</code></strong>=<em><code>True</code></em>)</p>
</blockquote>
<p>The DialogSystem class implements the main methods
defined in the settings module.</p>
<p>INPUT:</p>
<ul>
<li><p>context_data_file: csv file of contexts (default: None)</p>
</li>
<li><p>faq_data_file: csv file of FAQs (default: None)</p>
</li>
<li><p>configs_faq: json config file (default: None)</p>
</li>
<li><p>download_models: Indicates if download configuration files (default: True)</p>
</li>
</ul>
<p>If the context or the faq files are not provided, a <em>data</em> directory with the missing files,
will be created (in the same path where the module is running).</p>
<p>When an instance is created, the 'run_shell_installs', 'load_and_prepare_data'
and 'load_qa_models' of the settings module  are called. Also the <em>data</em> and <em>qa_models</em>
attributes are created, they store the dataframes and models information, respectively.</p>

</div>

</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="DialogSystem.new_context" class="doc_header"><code>DialogSystem.new_context</code><a href="https://github.com/kikejimenez/let_me_answer_for_you/tree/master/let_me_answer_for_you/dialog_system.py#L104" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>DialogSystem.new_context</code>(<strong><code>topic</code></strong>, <strong><code>context</code></strong>)</p>
</blockquote>
<p>Adds a new context.</p>
<p>INPUT:</p>
<ul>
<li>topic (The title of the context)</li>
<li>context</li>
</ul>
<p>The new context is stored in the path <em>self.data['context']['path']</em></p>

</div>

</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="DialogSystem.new_question_answer" class="doc_header"><code>DialogSystem.new_question_answer</code><a href="https://github.com/kikejimenez/let_me_answer_for_you/tree/master/let_me_answer_for_you/dialog_system.py#L83" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>DialogSystem.new_question_answer</code>(<strong><code>question</code></strong>, <strong><code>answer</code></strong>)</p>
</blockquote>
<p>Adds a new question-answer pair.</p>
<p>INPUT:</p>
<ul>
<li><p>question</p>
</li>
<li><p>answer</p>
</li>
</ul>
<p>The new question-answer pair is stored in the path <em>self.data['faq']['path']</em>
and the models in <em>qa_models['faq']</em> get re-trained by calling the function
<code>deeppavlaov.train_model</code></p>

</div>

</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="DialogSystem.question_answer" class="doc_header"><code>DialogSystem.question_answer</code><a href="https://github.com/kikejimenez/let_me_answer_for_you/tree/master/let_me_answer_for_you/dialog_system.py#L61" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>DialogSystem.question_answer</code>(<strong><code>question</code></strong>)</p>
</blockquote>
<p>Gets answers to a question.</p>
<p>INPUT:</p>
<ul>
<li><em>question</em> parameter </li>
</ul>
<p>The method creates the following attributes:</p>
<ul>
<li><p>'self.question' -&gt; the question parameter</p>
</li>
<li><p>'self.responses' -&gt; a dict of possible responses</p>
</li>
<li><p>'self.formatted_responses' -&gt; a formatted string of the possible responses</p>
</li>
</ul>
<p>This method calls the functions <code>settings.get_response</code> and <code>settings.format_responses</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Test-Example">Test Example<a class="anchor-link" href="#Test-Example"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#test</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">path</span>
<span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdirname</span><span class="p">:</span>

    <span class="n">ds</span> <span class="o">=</span> <span class="n">DialogSystem</span><span class="p">(</span>
        <span class="n">faq_data_file</span><span class="o">=</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="s1">&#39;faq_example.csv&#39;</span><span class="p">),</span>
        <span class="n">context_data_file</span><span class="o">=</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="s1">&#39;context_example.csv&#39;</span><span class="p">),</span>
        <span class="n">download_models</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>

    <span class="n">ds</span><span class="o">.</span><span class="n">question_answer</span><span class="p">(</span><span class="n">question</span><span class="o">=</span><span class="s1">&#39;What is Intekglobal?&#39;</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">ds</span><span class="o">.</span><span class="n">question</span> <span class="o">==</span> <span class="s1">&#39;What is Intekglobal?&#39;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">responses</span><span class="p">[</span><span class="s1">&#39;squad&#39;</span><span class="p">],</span> <span class="nb">dict</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">responses</span><span class="p">[</span><span class="s1">&#39;faq&#39;</span><span class="p">],</span> <span class="nb">dict</span><span class="p">)</span>
    
    
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ds</span><span class="o">.</span><span class="n">question</span><span class="si">}</span><span class="s1"> </span><span class="se">\n\n</span><span class="s1"> </span><span class="si">{</span><span class="n">ds</span><span class="o">.</span><span class="n">formatted_responses</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">assert</span> <span class="s1">&#39;This should not be in the current set of responses&#39;</span> <span class="ow">not</span> <span class="ow">in</span>  <span class="n">ds</span><span class="o">.</span><span class="n">formatted_responses</span> 
    
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39; dict of responses: </span><span class="si">{</span><span class="n">ds</span><span class="o">.</span><span class="n">responses</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ds</span><span class="o">.</span><span class="n">question</span><span class="si">}</span><span class="s1"> </span><span class="se">\n\n</span><span class="s1"> </span><span class="si">{</span><span class="n">ds</span><span class="o">.</span><span class="n">formatted_responses</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">ds</span><span class="o">.</span><span class="n">new_question_answer</span><span class="p">(</span>
        <span class="n">question</span><span class="o">=</span><span class="s1">&#39;What day is today?&#39;</span><span class="p">,</span> <span class="n">answer</span><span class="o">=</span><span class="s1">&#39;Today is the day!&#39;</span>
    <span class="p">)</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">question_answer</span><span class="p">(</span><span class="n">question</span><span class="o">=</span><span class="s1">&#39;What day is today?&#39;</span><span class="p">)</span>

    <span class="k">assert</span> <span class="s1">&#39;Today is the day!&#39;</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">formatted_responses</span>

    <span class="n">context</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;Space Exploration Technologies Corp., trading as SpaceX,</span>
<span class="s1">    is an American aerospace manufacturer and space transportation services company headquartered</span>
<span class="s1">    in Hawthorne, California. It was founded in 2002 by Elon Musk with the goal of reducing </span>
<span class="s1">    space transportation costs to enable the colonization of Mars. SpaceX has developed several launch </span>
<span class="s1">    vehicles,the Starlink satellite constellation, and the Dragon spacecraft.</span>
<span class="s1">    &#39;&#39;&#39;</span>

    <span class="n">ds</span><span class="o">.</span><span class="n">new_context</span><span class="p">(</span><span class="n">topic</span><span class="o">=</span><span class="s1">&#39;SpaceX&#39;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">question_answer</span><span class="p">(</span><span class="n">question</span><span class="o">=</span><span class="s1">&#39;What are SpaceX initials stand for?&#39;</span><span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ds</span><span class="o">.</span><span class="n">question</span><span class="si">}</span><span class="s1"> </span><span class="se">\n\n</span><span class="s1"> </span><span class="si">{</span><span class="n">ds</span><span class="o">.</span><span class="n">formatted_responses</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">assert</span> <span class="s1">&#39;Space Exploration Technologies Corp.&#39;</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">formatted_responses</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-14-5f26b5f71e52&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      7</span>         faq_data_file<span class="ansi-blue-fg">=</span>path<span class="ansi-blue-fg">.</span>join<span class="ansi-blue-fg">(</span>tmpdirname<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#39;faq_example.csv&#39;</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">      8</span>         context_data_file<span class="ansi-blue-fg">=</span>path<span class="ansi-blue-fg">.</span>join<span class="ansi-blue-fg">(</span>tmpdirname<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#39;context_example.csv&#39;</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span>
<span class="ansi-green-fg">----&gt; 9</span><span class="ansi-red-fg">         </span>download_models<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">False</span>
<span class="ansi-green-intense-fg ansi-bold">     10</span>     )
<span class="ansi-green-intense-fg ansi-bold">     11</span> 

<span class="ansi-green-fg">&lt;ipython-input-12-06830ddea14f&gt;</span> in <span class="ansi-cyan-fg">__init__</span><span class="ansi-blue-fg">(self, context_data_file, faq_data_file, configs_faq, download_models)</span>
<span class="ansi-green-intense-fg ansi-bold">     21</span>         download_models<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">True</span>
<span class="ansi-green-intense-fg ansi-bold">     22</span>     ):
<span class="ansi-green-fg">---&gt; 23</span><span class="ansi-red-fg">         </span>run_shell_installs<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     24</span>         self<span class="ansi-blue-fg">.</span>data <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">{</span><span class="ansi-blue-fg">&#39;context&#39;</span><span class="ansi-blue-fg">:</span> defaultdict<span class="ansi-blue-fg">(</span>str<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#39;faq&#39;</span><span class="ansi-blue-fg">:</span> defaultdict<span class="ansi-blue-fg">(</span>str<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">}</span>
<span class="ansi-green-intense-fg ansi-bold">     25</span>         self<span class="ansi-blue-fg">.</span>download <span class="ansi-blue-fg">=</span> download_models

<span class="ansi-red-fg">NameError</span>: name &#39;run_shell_installs&#39; is not defined</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#hide</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

