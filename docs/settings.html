---

title: Settings and Configuration

keywords: fastai
sidebar: home_sidebar

summary: "Question Answering Automated Dialog System "
description: "Question Answering Automated Dialog System "
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/01_settings.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="change_log_config" class="doc_header"><code>change_log_config</code><a href="https://github.com/kikejimenez/let_me_answer_for_you/tree/master/let_me_answer_for_you/settings.py#L24" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>change_log_config</code>()</p>
</blockquote>
<p>Change Deeppavlov configuration files to ERROR mode</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="run_shell_installs" class="doc_header"><code>run_shell_installs</code><a href="https://github.com/kikejimenez/let_me_answer_for_you/tree/master/let_me_answer_for_you/settings.py#L50" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>run_shell_installs</code>()</p>
</blockquote>
<p>Run install commands</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="action_over_list_f" class="doc_header"><code>action_over_list_f</code><a href="https://github.com/kikejimenez/let_me_answer_for_you/tree/master/let_me_answer_for_you/settings.py#L71" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>action_over_list_f</code>(<strong><code>arr</code></strong>, <strong><code>v</code></strong>)</p>
</blockquote>
<p>v[0] and v[1] are dictionaries
arr is array of dictionaries</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="replacement_f" class="doc_header"><code>replacement_f</code><a href="https://github.com/kikejimenez/let_me_answer_for_you/tree/master/let_me_answer_for_you/settings.py#L84" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>replacement_f</code>(<strong><code>model_config</code></strong>, <strong>**<code>args</code></strong>)</p>
</blockquote>
<p>Replaces the model config dictionary with new values</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># test action_over_list_f</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>


<span class="k">def</span> <span class="nf">gen_list_keys_for_tests</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;This is functio is used for tests</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">str_n</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span><span class="si">:</span><span class="s1">1</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="n">gen_dict_list</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">str_n</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">),</span>
        <span class="s1">&#39;key1&#39;</span><span class="p">:</span> <span class="n">str_n</span><span class="p">(</span><span class="s1">&#39;v1&#39;</span><span class="p">),</span>
        <span class="s1">&#39;key2&#39;</span><span class="p">:</span> <span class="n">str_n</span><span class="p">(</span><span class="s1">&#39;v2&#39;</span><span class="p">),</span>
        <span class="s1">&#39;key3&#39;</span><span class="p">:</span> <span class="n">str_n</span><span class="p">(</span><span class="s1">&#39;v3&#39;</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">pipe_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">gen_dict_list</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">))]</span>

    <span class="n">rand_id</span> <span class="o">=</span> <span class="n">pipe_list</span><span class="p">[</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pipe_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
    <span class="n">rand_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;key</span><span class="si">{</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span> 

    <span class="n">new_rand_val</span> <span class="o">=</span> <span class="n">str_n</span><span class="p">(</span><span class="s1">&#39;new&#39;</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;chains&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;pipe&#39;</span><span class="p">:</span> <span class="p">[{</span>
                <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">rand_id</span>
            <span class="p">},</span> <span class="p">{</span>
               <span class="n">rand_key</span> <span class="p">:</span> <span class="n">new_rand_val</span>
            <span class="p">}]</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">pipe_list</span><span class="p">,</span> <span class="n">rand_id</span><span class="p">,</span> <span class="n">rand_key</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">new_rand_val</span>


<span class="k">def</span> <span class="nf">test_action_over_list_f</span><span class="p">():</span>


    <span class="n">pipe_list</span><span class="p">,</span> <span class="n">rand_id</span><span class="p">,</span> <span class="n">rand_key</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">new_rand_val</span> <span class="o">=</span> <span class="n">gen_list_keys_for_tests</span><span class="p">()</span>

    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
        <span class="n">new_rand_val</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pipe_elem</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">pipe_elem</span> <span class="ow">in</span> <span class="n">pipe_list</span>
    <span class="p">)</span>

    <span class="n">action_over_list_f</span><span class="p">(</span><span class="n">pipe_list</span><span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;chains&#39;</span><span class="p">][</span><span class="s1">&#39;pipe&#39;</span><span class="p">])</span>

    <span class="k">assert</span> <span class="nb">any</span><span class="p">(</span>
        <span class="n">rand_key</span> <span class="ow">in</span> <span class="n">pipe_elem</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span>
        <span class="n">new_rand_val</span> <span class="ow">in</span> <span class="n">pipe_elem</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">pipe_elem</span> <span class="ow">in</span> <span class="n">pipe_list</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">test_replacement_f_list</span><span class="p">():</span>

    <span class="n">pipe_list</span><span class="p">,</span> <span class="n">rand_id</span><span class="p">,</span> <span class="n">rand_key</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">new_rand_val</span> <span class="o">=</span> <span class="n">gen_list_keys_for_tests</span><span class="p">()</span>

    <span class="n">mod_conf</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;chains&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;pipe&#39;</span><span class="p">:</span> <span class="n">pipe_list</span><span class="p">}}</span>

    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
        <span class="n">new_rand_val</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pipe_elem</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">pipe_elem</span> <span class="ow">in</span> <span class="n">mod_conf</span><span class="p">[</span><span class="s1">&#39;chains&#39;</span><span class="p">][</span><span class="s1">&#39;pipe&#39;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="n">replacement_f</span><span class="p">(</span><span class="n">model_config</span><span class="o">=</span><span class="n">mod_conf</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">any</span><span class="p">(</span>
        <span class="n">rand_key</span> <span class="ow">in</span> <span class="n">pipe_elem</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span>
        <span class="n">new_rand_val</span> <span class="ow">in</span> <span class="n">pipe_elem</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">pipe_elem</span> <span class="ow">in</span> <span class="n">mod_conf</span><span class="p">[</span><span class="s1">&#39;chains&#39;</span><span class="p">][</span><span class="s1">&#39;pipe&#39;</span><span class="p">]</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">test_replacement_f_val</span><span class="p">():</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;key3&#39;</span><span class="p">:</span> <span class="s1">&#39;newvalue&#39;</span><span class="p">}</span>
    <span class="n">mod_conf</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;key1&#39;</span><span class="p">:</span> <span class="s1">&#39;val1&#39;</span><span class="p">,</span> <span class="s1">&#39;key2&#39;</span><span class="p">:</span> <span class="s1">&#39;val2&#39;</span><span class="p">,</span> <span class="s1">&#39;key3&#39;</span><span class="p">:</span> <span class="s1">&#39;val3&#39;</span><span class="p">}</span>
    <span class="n">replacement_f</span><span class="p">(</span><span class="n">model_config</span><span class="o">=</span><span class="n">mod_conf</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
        <span class="n">arg_k</span> <span class="ow">in</span> <span class="n">mod_conf</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">arg_v</span> <span class="ow">in</span> <span class="n">mod_conf</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">arg_k</span><span class="p">,</span> <span class="n">arg_v</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">test_replacement_f_dict</span><span class="p">():</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;1_key_3&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;2_key_2&#39;</span><span class="p">:</span> <span class="s1">&#39;newvalue&#39;</span><span class="p">}}</span>
    <span class="n">mod_conf</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;1_key_3&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;2_key_2&#39;</span><span class="p">:</span> <span class="s1">&#39;oldvalue&#39;</span><span class="p">},</span> <span class="s1">&#39;0_key_&#39;</span><span class="p">:</span> <span class="s1">&#39;0_val&#39;</span><span class="p">}</span>
    <span class="n">replacement_f</span><span class="p">(</span><span class="n">model_config</span><span class="o">=</span><span class="n">mod_conf</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">mod_conf</span><span class="p">[</span><span class="s1">&#39;1_key_3&#39;</span><span class="p">][</span><span class="s1">&#39;2_key_2&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;newvalue&#39;</span>


<span class="n">test_action_over_list_f</span><span class="p">()</span>
<span class="n">test_replacement_f_list</span><span class="p">()</span>
<span class="n">test_replacement_f_val</span><span class="p">()</span>
<span class="n">test_replacement_f_dict</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="updates_faq_config_file" class="doc_header"><code>updates_faq_config_file</code><a href="https://github.com/kikejimenez/let_me_answer_for_you/tree/master/let_me_answer_for_you/settings.py#L96" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>updates_faq_config_file</code>(<strong><code>configs_path</code></strong>, <strong>**<code>args</code></strong>)</p>
</blockquote>
<p>Updates deepplavov json config file</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#test updates_faq_config_file</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">from</span> <span class="nn">shutil</span> <span class="kn">import</span> <span class="n">copyfile</span>


<span class="k">def</span> <span class="nf">gen_list_keys_for_tests</span><span class="p">():</span>

    <span class="n">str_n</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span><span class="si">:</span><span class="s1">1</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="n">gen_dict_list</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">str_n</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">),</span>
        <span class="s1">&#39;key1&#39;</span><span class="p">:</span> <span class="n">str_n</span><span class="p">(</span><span class="s1">&#39;v1&#39;</span><span class="p">),</span>
        <span class="s1">&#39;key2&#39;</span><span class="p">:</span> <span class="n">str_n</span><span class="p">(</span><span class="s1">&#39;v2&#39;</span><span class="p">),</span>
        <span class="s1">&#39;key3&#39;</span><span class="p">:</span> <span class="n">str_n</span><span class="p">(</span><span class="s1">&#39;v3&#39;</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">pipe_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">gen_dict_list</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">))]</span>

    <span class="n">rand_id</span> <span class="o">=</span> <span class="n">pipe_list</span><span class="p">[</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pipe_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
    <span class="n">rand_key</span> <span class="o">=</span>  <span class="sa">f</span><span class="s1">&#39;key</span><span class="si">{</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span> 

    <span class="n">new_rand_val</span> <span class="o">=</span> <span class="n">str_n</span><span class="p">(</span><span class="s1">&#39;new&#39;</span><span class="p">)</span>
    <span class="n">pipe_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;pipe&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">rand_id</span><span class="p">},</span> <span class="p">{</span><span class="n">rand_key</span><span class="p">:</span> <span class="n">new_rand_val</span><span class="p">}]}</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;chainer&#39;</span><span class="p">:</span> <span class="n">pipe_dict</span><span class="p">}</span>

    <span class="k">return</span> <span class="n">pipe_list</span><span class="p">,</span> <span class="n">rand_id</span><span class="p">,</span> <span class="n">rand_key</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">new_rand_val</span>


<span class="k">def</span> <span class="nf">test_updates_faq_config_file_update_string</span><span class="p">():</span>

    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdirname</span><span class="p">:</span>

        <span class="n">tmp_config_file</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="s1">&#39;tmp_file.json&#39;</span><span class="p">)</span>

        <span class="n">copyfile</span><span class="p">(</span><span class="n">configs</span><span class="o">.</span><span class="n">faq</span><span class="o">.</span><span class="n">tfidf_logreg_en_faq</span><span class="p">,</span> <span class="n">tmp_config_file</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">tmp_config_file</span><span class="p">)</span>

        <span class="n">updates_faq_config_file</span><span class="p">(</span>
            <span class="n">configs_path</span><span class="o">=</span><span class="n">tmp_config_file</span><span class="p">,</span>
            <span class="n">dataset_reader</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;data_path&#39;</span><span class="p">:</span> <span class="s1">&#39;fictional_csv_file.csv&#39;</span><span class="p">}</span>
        <span class="p">)</span>

        <span class="n">config_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">tmp_config_file</span><span class="p">))</span>
        <span class="k">assert</span> <span class="s1">&#39;data_path&#39;</span> <span class="ow">in</span> <span class="n">config_json</span><span class="p">[</span><span class="s1">&#39;dataset_reader&#39;</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">test_updates_faq_config_file_update_list</span><span class="p">():</span>

    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdirname</span><span class="p">:</span>

        <span class="n">tmp_config_file</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="s1">&#39;tmp_file.json&#39;</span><span class="p">)</span>

        <span class="n">pipe_list</span><span class="p">,</span> <span class="n">rand_id</span><span class="p">,</span> <span class="n">rand_key</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">new_rand_val</span> <span class="o">=</span> <span class="n">gen_list_keys_for_tests</span><span class="p">(</span>
        <span class="p">)</span>
        <span class="n">mod_conf</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;chainer&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;pipe&#39;</span><span class="p">:</span> <span class="n">pipe_list</span>
            <span class="p">},</span>
            <span class="s1">&#39;dataset_reader&#39;</span><span class="p">:</span> <span class="s1">&#39;dataset_reader_dictionary&#39;</span>
        <span class="p">}</span>

        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">mod_conf</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">tmp_config_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">))</span>

        <span class="k">assert</span> <span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">tmp_config_file</span><span class="p">)</span>

        <span class="n">updates_faq_config_file</span><span class="p">(</span><span class="n">configs_path</span><span class="o">=</span><span class="n">tmp_config_file</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>

        <span class="n">config_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">tmp_config_file</span><span class="p">))</span>
   
        <span class="k">assert</span> <span class="nb">any</span><span class="p">(</span>
            <span class="n">rand_key</span> <span class="ow">in</span> <span class="n">pipe_elem</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">new_rand_val</span> <span class="ow">in</span> <span class="n">pipe_elem</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">pipe_elem</span> <span class="ow">in</span> <span class="n">config_json</span><span class="p">[</span><span class="s1">&#39;chainer&#39;</span><span class="p">][</span><span class="s1">&#39;pipe&#39;</span><span class="p">]</span>
        <span class="p">)</span>


<span class="n">test_updates_faq_config_file_update_string</span><span class="p">()</span>
<span class="n">test_updates_faq_config_file_update_list</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="select_faq_responses" class="doc_header"><code>select_faq_responses</code><a href="https://github.com/kikejimenez/let_me_answer_for_you/tree/master/let_me_answer_for_you/settings.py#L113" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>select_faq_responses</code>(<strong><code>faq_model</code></strong>, <strong><code>question</code></strong>)</p>
</blockquote>
<p>Calls Deeppavlov FAQ model</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#test faq responses</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">from</span> <span class="nn">shutil</span> <span class="kn">import</span> <span class="n">copyfile</span>


<span class="k">def</span> <span class="nf">gen_mock_csv_file</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="n">faqs</span><span class="p">):</span>

    <span class="n">temp_faq_csv</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="s1">&#39;tmp_faq.csv&#39;</span><span class="p">)</span>

    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">faqs</span><span class="p">)</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">temp_faq_csv</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">temp_faq_csv</span>


<span class="k">def</span> <span class="nf">gen_mock_vocab_answers</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="n">vocabs</span><span class="p">):</span>

    <span class="n">temp_dict_file</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="s1">&#39;temp_vocab_answers.dict&#39;</span><span class="p">)</span>
    <span class="n">vocabs_text</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">t</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">vocabs</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span> <span class="n">vocabs</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">])</span>
    <span class="p">)</span>

    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">temp_dict_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">vocabs_text</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">temp_dict_file</span>


<span class="k">def</span> <span class="nf">gen_faq_config</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="n">vocab_file</span><span class="p">,</span> <span class="n">faq_file</span><span class="p">):</span>

    <span class="n">temp_configs_faq</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="s1">&#39;temp_config_faq.json&#39;</span><span class="p">)</span>
    <span class="n">copyfile</span><span class="p">(</span><span class="n">configs</span><span class="o">.</span><span class="n">faq</span><span class="o">.</span><span class="n">tfidf_logreg_en_faq</span><span class="p">,</span> <span class="n">temp_configs_faq</span><span class="p">)</span>

    <span class="n">changes_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;save_path&#39;</span><span class="p">:</span> <span class="n">vocab_file</span><span class="p">,</span> <span class="s1">&#39;load_path&#39;</span><span class="p">:</span> <span class="n">vocab_file</span><span class="p">}</span>
    <span class="n">id_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;answers_vocab&#39;</span><span class="p">}</span>

    <span class="n">updates_faq_config_file</span><span class="p">(</span>
        <span class="n">configs_path</span><span class="o">=</span><span class="n">temp_configs_faq</span><span class="p">,</span>
        <span class="n">chainer</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;pipe&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">id_dict</span><span class="p">,</span> <span class="n">changes_dict</span><span class="p">]},</span>
        <span class="n">dataset_reader</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;data_path&#39;</span><span class="p">:</span> <span class="n">faq_file</span><span class="p">}</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">temp_configs_faq</span>


<span class="k">def</span> <span class="nf">test_faq_response_with_minimum_faqs_in_dataframe_fail_case</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdirname</span><span class="p">:</span>

        <span class="n">faqs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Question&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Is Covid erradicated?&#39;</span><span class="p">],</span>
            <span class="s1">&#39;Answer&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Definitely not!&#39;</span><span class="p">]</span>
        <span class="p">}</span>

        <span class="n">vocabs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;This is a vocab example&#39;</span><span class="p">],</span> <span class="s1">&#39;freq&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">]}</span>

        <span class="n">faq_file</span> <span class="o">=</span> <span class="n">gen_mock_csv_file</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="n">faqs</span><span class="p">)</span>
        <span class="n">vocab_file</span> <span class="o">=</span> <span class="n">gen_mock_vocab_answers</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="n">vocabs</span><span class="p">)</span>

        <span class="n">configs_file</span> <span class="o">=</span> <span class="n">gen_faq_config</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="n">vocab_file</span><span class="p">,</span> <span class="n">faq_file</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">select_faq_responses</span><span class="p">(</span>
                <span class="n">question</span><span class="o">=</span><span class="s1">&#39;Is Enrique the prettiest person in town?&#39;</span><span class="p">,</span>
                <span class="n">faq_model</span><span class="o">=</span><span class="n">train_model</span><span class="p">(</span><span class="n">configs_file</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">assert</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">assert</span> <span class="kc">True</span>


<span class="k">def</span> <span class="nf">test_faq_response_with_minimum_faqs_in_dataframe_success_case</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdirname</span><span class="p">:</span>

        <span class="n">faqs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Question&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Is Covid erradicated?&#39;</span><span class="p">,</span> <span class="s1">&#39;Who is the current POTUS?&#39;</span><span class="p">],</span>
            <span class="s1">&#39;Answer&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Definitely not!&#39;</span><span class="p">,</span> <span class="s1">&#39;Donald Trump&#39;</span><span class="p">]</span>
        <span class="p">}</span>

        <span class="n">vocabs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;This is a vocab example&#39;</span><span class="p">],</span> <span class="s1">&#39;freq&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">]}</span>

        <span class="n">faq_file</span> <span class="o">=</span> <span class="n">gen_mock_csv_file</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="n">faqs</span><span class="p">)</span>
        <span class="n">vocab_file</span> <span class="o">=</span> <span class="n">gen_mock_vocab_answers</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="n">vocabs</span><span class="p">)</span>

        <span class="n">configs_file</span> <span class="o">=</span> <span class="n">gen_faq_config</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="n">vocab_file</span><span class="p">,</span> <span class="n">faq_file</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">select_faq_responses</span><span class="p">(</span>
            <span class="n">question</span><span class="o">=</span><span class="s1">&#39;Is Enrique the prettiest person in town?&#39;</span><span class="p">,</span>
            <span class="n">faq_model</span><span class="o">=</span><span class="n">train_model</span><span class="p">(</span><span class="n">configs_file</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;Donald Trump&#39;</span><span class="p">]</span>

        
        
<span class="k">def</span> <span class="nf">test_faq_response_with_minimum_answers_vocab_success_case</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdirname</span><span class="p">:</span>

        <span class="n">faqs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Question&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Is Covid erradicated?&#39;</span><span class="p">,</span> <span class="s1">&#39;Who is the current POTUS?&#39;</span><span class="p">],</span>
            <span class="s1">&#39;Answer&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Definitely not!&#39;</span><span class="p">,</span> <span class="s1">&#39;Donald Trump&#39;</span><span class="p">]</span>
        <span class="p">}</span>

        <span class="n">vocabs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;freq&#39;</span><span class="p">:</span> <span class="p">[]}</span>

        <span class="n">faq_file</span> <span class="o">=</span> <span class="n">gen_mock_csv_file</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="n">faqs</span><span class="p">)</span>
        <span class="n">vocab_file</span> <span class="o">=</span> <span class="n">gen_mock_vocab_answers</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="n">vocabs</span><span class="p">)</span>

        <span class="n">configs_file</span> <span class="o">=</span> <span class="n">gen_faq_config</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="n">vocab_file</span><span class="p">,</span> <span class="n">faq_file</span><span class="p">)</span>

        <span class="n">select_faq_responses</span><span class="p">(</span>
            <span class="n">question</span><span class="o">=</span><span class="s1">&#39;Is Enrique the prettiest person in town?&#39;</span><span class="p">,</span>
            <span class="n">faq_model</span><span class="o">=</span><span class="n">train_model</span><span class="p">(</span><span class="n">configs_file</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;Donald Trump&#39;</span><span class="p">]</span>

<span class="n">test_faq_response_with_minimum_faqs_in_dataframe_fail_case</span><span class="p">()</span>
<span class="n">test_faq_response_with_minimum_faqs_in_dataframe_success_case</span><span class="p">()</span>
<span class="n">test_faq_response_with_minimum_answers_vocab_success_case</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>09:09:15 DEBUG:Starting new HTTP connection (1): files.deeppavlov.ai:80
09:09:15 DEBUG:http://files.deeppavlov.ai:80 &#34;GET /faq/mipt/en_mipt_faq_v4.tar.gz.md5 HTTP/1.1&#34; 200 189
09:09:15 DEBUG:Starting new HTTP connection (1): files.deeppavlov.ai:80
09:09:16 DEBUG:http://files.deeppavlov.ai:80 &#34;GET /faq/mipt/en_mipt_faq_v4.tar.gz HTTP/1.1&#34; 200 12276
100%|██████████| 12.3k/12.3k [00:00&lt;00:00, 6.87MB/s]
/opt/conda/lib/python3.7/site-packages/sklearn/linear_model/logistic.py:432: FutureWarning: Default solver will be changed to &#39;lbfgs&#39; in 0.22. Specify a solver to silence this warning.
  FutureWarning)
09:09:17 DEBUG:Starting new HTTP connection (1): files.deeppavlov.ai:80
09:09:18 DEBUG:http://files.deeppavlov.ai:80 &#34;GET /faq/mipt/en_mipt_faq_v4.tar.gz.md5 HTTP/1.1&#34; 200 189
09:09:18 DEBUG:Starting new HTTP connection (1): files.deeppavlov.ai:80
09:09:18 DEBUG:http://files.deeppavlov.ai:80 &#34;GET /faq/mipt/en_mipt_faq_v4.tar.gz HTTP/1.1&#34; 200 12276
100%|██████████| 12.3k/12.3k [00:00&lt;00:00, 5.89MB/s]
/opt/conda/lib/python3.7/site-packages/sklearn/linear_model/logistic.py:432: FutureWarning: Default solver will be changed to &#39;lbfgs&#39; in 0.22. Specify a solver to silence this warning.
  FutureWarning)
09:09:21 DEBUG:Starting new HTTP connection (1): files.deeppavlov.ai:80
09:09:21 DEBUG:http://files.deeppavlov.ai:80 &#34;GET /faq/mipt/en_mipt_faq_v4.tar.gz.md5 HTTP/1.1&#34; 200 189
09:09:21 DEBUG:Starting new HTTP connection (1): files.deeppavlov.ai:80
09:09:22 DEBUG:http://files.deeppavlov.ai:80 &#34;GET /faq/mipt/en_mipt_faq_v4.tar.gz HTTP/1.1&#34; 200 12276
100%|██████████| 12.3k/12.3k [00:00&lt;00:00, 12.7MB/s]
/opt/conda/lib/python3.7/site-packages/sklearn/linear_model/logistic.py:432: FutureWarning: Default solver will be changed to &#39;lbfgs&#39; in 0.22. Specify a solver to silence this warning.
  FutureWarning)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="select_squad_responses" class="doc_header"><code>select_squad_responses</code><a href="https://github.com/kikejimenez/let_me_answer_for_you/tree/master/let_me_answer_for_you/settings.py#L119" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>select_squad_responses</code>(<strong><code>contexts</code></strong>, <strong><code>squad_model</code></strong>, <strong><code>question</code></strong>, <strong><code>best_results</code></strong>=<em><code>1</code></em>)</p>
</blockquote>
<p>Calls Deeppavlov BERT and RNET Context Question Answering</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#test select_squad_responses</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">from</span> <span class="nn">shutil</span> <span class="kn">import</span> <span class="n">copyfile</span>

<span class="n">empty</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;topic&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;context&#39;</span><span class="p">:</span> <span class="p">[]}</span>
<span class="n">spacex</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;topic&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;SpaceX&#39;</span><span class="p">],</span>
    <span class="s1">&#39;context&#39;</span><span class="p">:</span>
        <span class="p">[</span>
            <span class="sd">&#39;&#39;&#39;Space Exploration Technologies Corp., trading as SpaceX, is an American aerospace manufacturer and space transportation</span>
<span class="sd">services company headquartered in Hawthorne, California. It was founded in 2002 by Elon Musk with the goal of reducing space </span>
<span class="sd">transportation costs to enable the colonization of Mars. SpaceX has developed several launch vehicles, the Starlink satellite</span>
<span class="sd">constellation, and the Dragon spacecraft. It is widely considered among the most successful private spaceflight companies.&#39;&#39;&#39;</span>
        <span class="p">]</span>
<span class="p">}</span>

<span class="n">intekglobal</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;topic&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Intekglobal&#39;</span><span class="p">,</span> <span class="s1">&#39;InG&#39;</span><span class="p">],</span>
    <span class="s1">&#39;context&#39;</span><span class="p">:</span>
        <span class="p">[</span>
            <span class="s1">&#39;Intekglobal has its headquarters located in TJ&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Intekglobal is in the north of mexico&#39;</span>
        <span class="p">]</span>
<span class="p">}</span>


<span class="k">def</span> <span class="nf">assert_squad_model</span><span class="p">(</span>
    <span class="n">contexts</span><span class="p">,</span> <span class="n">squad_model</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="n">expected_responses</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span>
<span class="p">):</span>
    <span class="n">responses</span><span class="p">,</span> <span class="n">top_responses</span> <span class="o">=</span> <span class="n">select_squad_responses</span><span class="p">(</span>
        <span class="n">contexts</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">contexts</span><span class="p">),</span>
        <span class="n">squad_model</span><span class="o">=</span><span class="n">squad_model</span><span class="p">,</span>
        <span class="n">question</span><span class="o">=</span><span class="n">question</span><span class="p">,</span>
        <span class="o">**</span><span class="n">args</span>
    <span class="p">)</span>
    <span class="k">assert</span> <span class="n">top_responses</span> <span class="o">==</span> <span class="n">expected_responses</span>


<span class="k">def</span> <span class="nf">test_squad_bert</span><span class="p">():</span>

    <span class="n">bert</span> <span class="o">=</span> <span class="n">build_model</span><span class="p">(</span><span class="n">configs</span><span class="o">.</span><span class="n">squad</span><span class="o">.</span><span class="n">squad_bert</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">assert_squad_model</span><span class="p">(</span>
        <span class="n">empty</span><span class="p">,</span>
        <span class="n">bert</span><span class="p">,</span>
        <span class="s1">&#39;Is an empty response expected?&#39;</span><span class="p">,</span>
        <span class="n">expected_responses</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">best_results</span><span class="o">=</span><span class="mi">2</span>
    <span class="p">)</span>

    <span class="n">assert_squad_model</span><span class="p">(</span>
        <span class="n">spacex</span><span class="p">,</span> <span class="n">bert</span><span class="p">,</span> <span class="s1">&#39;Who founded SpaceX?&#39;</span><span class="p">,</span> <span class="n">expected_responses</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Elon Musk&#39;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="n">assert_squad_model</span><span class="p">(</span>
        <span class="n">intekglobal</span><span class="p">,</span>
        <span class="n">bert</span><span class="p">,</span>
        <span class="s1">&#39;Where is Intekglobal located?&#39;</span><span class="p">,</span>
        <span class="n">expected_responses</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;north of mexico&#39;</span><span class="p">,</span><span class="s1">&#39;TJ&#39;</span><span class="p">],</span>
        <span class="n">best_results</span><span class="o">=</span><span class="mi">2</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">test_squad_rnet</span><span class="p">():</span>

    <span class="n">bert</span> <span class="o">=</span> <span class="n">build_model</span><span class="p">(</span><span class="n">configs</span><span class="o">.</span><span class="n">squad</span><span class="o">.</span><span class="n">squad</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">assert_squad_model</span><span class="p">(</span>
        <span class="n">empty</span><span class="p">,</span>
        <span class="n">bert</span><span class="p">,</span>
        <span class="s1">&#39;Is an empty response expected?&#39;</span><span class="p">,</span>
        <span class="n">expected_responses</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">best_results</span><span class="o">=</span><span class="mi">5</span>
    <span class="p">)</span>

    <span class="n">assert_squad_model</span><span class="p">(</span>
        <span class="n">spacex</span><span class="p">,</span> <span class="n">bert</span><span class="p">,</span> <span class="s1">&#39;Who founded SpaceX?&#39;</span><span class="p">,</span> <span class="n">expected_responses</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Elon Musk&#39;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="n">assert_squad_model</span><span class="p">(</span>
        <span class="n">intekglobal</span><span class="p">,</span>
        <span class="n">bert</span><span class="p">,</span>
        <span class="s1">&#39;Where is Intekglobal located?&#39;</span><span class="p">,</span>
        <span class="n">expected_responses</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;north of mexico&#39;</span><span class="p">,</span><span class="s1">&#39;TJ&#39;</span><span class="p">],</span>
        <span class="n">best_results</span><span class="o">=</span><span class="mi">2</span>
    <span class="p">)</span>

<span class="n">test_squad_bert</span><span class="p">()</span>
<span class="n">test_squad_rnet</span><span class="p">()</span>
<span class="k">del</span> <span class="n">spacex</span><span class="p">,</span> <span class="n">empty</span><span class="p">,</span> <span class="n">intekglobal</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>09:09:27 DEBUG:Starting new HTTP connection (1): files.deeppavlov.ai:80
09:09:28 DEBUG:http://files.deeppavlov.ai:80 &#34;GET /deeppavlov_data/bert/cased_L-12_H-768_A-12.zip.md5 HTTP/1.1&#34; 200 386
09:09:29 DEBUG:Starting new HTTP connection (1): files.deeppavlov.ai:80
09:09:29 DEBUG:http://files.deeppavlov.ai:80 &#34;GET /deeppavlov_data/squad_bert.tar.gz.md5 HTTP/1.1&#34; 200 184
09:09:46 INFO:Restoring parameters from /home/jovyan/.deeppavlov/models/squad_bert/model
09:09:47 DEBUG:Responses: []
09:09:47 DEBUG:Top Responses: []
09:09:49 DEBUG:Responses: [list([[&#39;Elon Musk&#39;], [203], [50257280.0]])]
09:09:49 DEBUG:Top Responses: [&#39;Elon Musk&#39;]
09:09:50 DEBUG:Responses: [list([[&#39;TJ&#39;], [44], [6978.86279296875]])
 list([[&#39;north of mexico&#39;], [22], [81567.328125]])]
09:09:50 DEBUG:Top Responses: [&#39;north of mexico&#39;, &#39;TJ&#39;]
09:09:50 DEBUG:Starting new HTTP connection (1): files.deeppavlov.ai:80
09:09:51 DEBUG:http://files.deeppavlov.ai:80 &#34;GET /embeddings/wiki-news-300d-1M-char.vec.md5 HTTP/1.1&#34; 200 61
09:09:51 DEBUG:Starting new HTTP connection (1): files.deeppavlov.ai:80
09:09:51 DEBUG:http://files.deeppavlov.ai:80 &#34;GET /embeddings/wiki-news-300d-1M.vec.md5 HTTP/1.1&#34; 200 56
09:09:55 DEBUG:Starting new HTTP connection (1): files.deeppavlov.ai:80
09:09:56 DEBUG:http://files.deeppavlov.ai:80 &#34;GET /deeppavlov_data/squad_model_1.4_cpu_compatible.tar.gz.md5 HTTP/1.1&#34; 200 389
09:10:15 INFO:Restoring parameters from /home/jovyan/.deeppavlov/models/squad_model/model
09:10:16 DEBUG:Responses: []
09:10:16 DEBUG:Top Responses: []
09:10:18 DEBUG:Responses: [list([[&#39;Elon Musk&#39;], [203], [36056324.0]])]
09:10:18 DEBUG:Top Responses: [&#39;Elon Musk&#39;]
09:10:18 DEBUG:Responses: [list([[&#39;TJ&#39;], [44], [564.4996948242188]])
 list([[&#39;north of mexico&#39;], [22], [138151.90625]])]
09:10:18 DEBUG:Top Responses: [&#39;north of mexico&#39;, &#39;TJ&#39;]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="load_qa_models" class="doc_header"><code>load_qa_models</code><a href="https://github.com/kikejimenez/let_me_answer_for_you/tree/master/let_me_answer_for_you/settings.py#L138" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>load_qa_models</code>(<strong><code>config_rnet</code></strong>=<em><code>PosixPath('/opt/conda/lib/python3.7/site-packages/deeppavlov/configs/squad/squad.json')</code></em>, <strong><code>config_bert</code></strong>=<em><code>PosixPath('/opt/conda/lib/python3.7/site-packages/deeppavlov/configs/squad/squad_bert.json')</code></em>, <strong><code>config_tfidf</code></strong>=<em><code>PosixPath('/opt/conda/lib/python3.7/site-packages/deeppavlov/configs/faq/tfidf_logreg_en_faq.json')</code></em>, <strong><code>download</code></strong>=<em><code>True</code></em>)</p>
</blockquote>
<p>Load the squad and faq models</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="format_responses" class="doc_header"><code>format_responses</code><a href="https://github.com/kikejimenez/let_me_answer_for_you/tree/master/let_me_answer_for_you/settings.py#L159" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>format_responses</code>(<strong><code>question</code></strong>, <strong><code>responses</code></strong>)</p>
</blockquote>
<p>Format question-response pair</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_responses" class="doc_header"><code>get_responses</code><a href="https://github.com/kikejimenez/let_me_answer_for_you/tree/master/let_me_answer_for_you/settings.py#L168" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_responses</code>(<strong><code>contexts</code></strong>, <strong><code>question</code></strong>, <strong><code>qa_models</code></strong>, <strong><code>nb_squad_results</code></strong>=<em><code>1</code></em>)</p>
</blockquote>
<p>Get response from a quesiton using qa_models and contexts</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># test get_responses</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">from</span> <span class="nn">shutil</span> <span class="kn">import</span> <span class="n">copyfile</span>

<span class="n">intekglobal_context</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;topic&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Intekglobal&#39;</span><span class="p">,</span> <span class="s1">&#39;InG&#39;</span><span class="p">],</span>
    <span class="s1">&#39;context&#39;</span><span class="p">:</span>
        <span class="p">[</span>
            <span class="s1">&#39;Intekglobal has its headquarters located in TJ&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Intekglobal is in the north of mexico&#39;</span>
        <span class="p">]</span>
<span class="p">}</span>

<span class="n">intekglobal_faqs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Question&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Is Intekglobal an IT company?&#39;</span><span class="p">,</span> <span class="s1">&#39;Where can I apply?&#39;</span><span class="p">],</span>
    <span class="s1">&#39;Answer&#39;</span><span class="p">:</span>
        <span class="p">[</span><span class="s1">&#39;Yes it is!&#39;</span><span class="p">,</span> <span class="s1">&#39;Please refer the our website for further information&#39;</span><span class="p">]</span>
<span class="p">}</span>


<span class="k">def</span> <span class="nf">mock_faq_files</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="n">faqs</span><span class="p">):</span>

    <span class="n">faq_files</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="s1">&#39;temp_faq.csv&#39;</span><span class="p">),</span>
        <span class="s1">&#39;config&#39;</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="s1">&#39;temp_config_faq.json&#39;</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">faqs</span><span class="p">)</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">faq_files</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">copyfile</span><span class="p">(</span><span class="n">configs</span><span class="o">.</span><span class="n">faq</span><span class="o">.</span><span class="n">tfidf_logreg_en_faq</span><span class="p">,</span> <span class="n">faq_files</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">])</span>

    <span class="n">updates_faq_config_file</span><span class="p">(</span>
        <span class="n">configs_path</span><span class="o">=</span><span class="n">faq_files</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">],</span>
        <span class="n">dataset_reader</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;data_path&#39;</span><span class="p">:</span> <span class="n">faq_files</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]}</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">faq_files</span>


<span class="k">def</span> <span class="nf">test_get_intekglobal_responses</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdirname</span><span class="p">:</span>

        <span class="n">faq_files</span> <span class="o">=</span> <span class="n">mock_faq_files</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="n">intekglobal_faqs</span><span class="p">)</span>
        <span class="n">qa_models</span> <span class="o">=</span> <span class="n">load_qa_models</span><span class="p">(</span>
            <span class="n">config_tfidf</span><span class="o">=</span><span class="n">faq_files</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">],</span> <span class="n">download</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

        <span class="n">responses</span><span class="p">,</span> <span class="n">format_responses</span> <span class="o">=</span> <span class="n">get_responses</span><span class="p">(</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">intekglobal_context</span><span class="p">),</span>
            <span class="s1">&#39;Where is Intekglobal?&#39;</span><span class="p">,</span>
            <span class="n">qa_models</span><span class="p">,</span>
            <span class="n">nb_squad_results</span><span class="o">=</span><span class="mi">2</span>
        <span class="p">)</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">responses</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">format_responses</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
            <span class="n">response</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;north of mexico&#39;</span><span class="p">,</span> <span class="s1">&#39;TJ&#39;</span><span class="p">,</span> <span class="s1">&#39;Yes it is!&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">response</span> <span class="ow">in</span> <span class="n">responses</span>
        <span class="p">)</span>


<span class="k">def</span> <span class="nf">test_get_responses_with_empty_context</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdirname</span><span class="p">:</span>
        <span class="n">min_faqs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Question&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Minimum number of questions?&#39;</span><span class="p">,</span><span class="s1">&#39;This is the other question?&#39;</span><span class="p">],</span> <span class="s1">&#39;Answer&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Two&#39;</span><span class="p">,</span><span class="s1">&#39;yes&#39;</span><span class="p">]}</span>
        <span class="n">faq_files</span> <span class="o">=</span> <span class="n">mock_faq_files</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="n">min_faqs</span><span class="p">)</span>

        <span class="n">qa_models</span> <span class="o">=</span> <span class="n">load_qa_models</span><span class="p">(</span>
            <span class="n">config_tfidf</span><span class="o">=</span><span class="n">faq_files</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">],</span> <span class="n">download</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="n">empty_context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;topic&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;context&#39;</span><span class="p">:</span> <span class="p">[]}</span>

        <span class="n">responses</span><span class="p">,</span> <span class="n">format_responses</span> <span class="o">=</span> <span class="n">get_responses</span><span class="p">(</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">empty_context</span><span class="p">),</span>
            <span class="s1">&#39;What is the minimun number of FAQ questions&#39;</span><span class="p">,</span>
            <span class="n">qa_models</span><span class="p">,</span>
            <span class="n">nb_squad_results</span><span class="o">=</span><span class="mi">2</span>
        <span class="p">)</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">responses</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">format_responses</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">responses</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;Two&#39;</span><span class="p">]</span>


<span class="n">test_get_intekglobal_responses</span><span class="p">()</span>
<span class="n">test_get_responses_with_empty_context</span><span class="p">()</span>

<span class="k">del</span> <span class="n">intekglobal_context</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>09:10:40 INFO:Restoring parameters from /home/jovyan/.deeppavlov/models/squad_model/model
09:10:59 INFO:Restoring parameters from /home/jovyan/.deeppavlov/models/squad_bert/model
/opt/conda/lib/python3.7/site-packages/sklearn/linear_model/logistic.py:432: FutureWarning: Default solver will be changed to &#39;lbfgs&#39; in 0.22. Specify a solver to silence this warning.
  FutureWarning)
09:11:04 DEBUG:Responses: [list([[&#39;TJ&#39;], [44], [120.95974731445312]])
 list([[&#39;north of mexico&#39;], [22], [174602.40625]])]
09:11:04 DEBUG:Top Responses: [&#39;north of mexico&#39;, &#39;TJ&#39;]
09:11:07 DEBUG:Responses: [list([[&#39;TJ&#39;], [44], [22507.34375]])
 list([[&#39;north of mexico&#39;], [22], [269778.3125]])]
09:11:07 DEBUG:Top Responses: [&#39;north of mexico&#39;, &#39;TJ&#39;]
09:11:07 DEBUG:[&#39;north of mexico&#39;, &#39;TJ&#39;, &#39;north of mexico&#39;, &#39;TJ&#39;, &#39;Yes it is!&#39;]
09:11:07 DEBUG:Where is Intekglobal?:

1: north of mexico
2: TJ
3: Yes it is!

09:11:30 INFO:Restoring parameters from /home/jovyan/.deeppavlov/models/squad_model/model
09:11:59 INFO:Restoring parameters from /home/jovyan/.deeppavlov/models/squad_bert/model
/opt/conda/lib/python3.7/site-packages/sklearn/linear_model/logistic.py:432: FutureWarning: Default solver will be changed to &#39;lbfgs&#39; in 0.22. Specify a solver to silence this warning.
  FutureWarning)
09:12:06 DEBUG:Responses: []
09:12:06 DEBUG:Top Responses: []
09:12:06 DEBUG:Responses: []
09:12:06 DEBUG:Top Responses: []
09:12:06 DEBUG:[&#39;Two&#39;]
09:12:06 DEBUG:What is the minimun number of FAQ questions:

1: Two

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_input" class="doc_header"><code>get_input</code><a href="https://github.com/kikejimenez/let_me_answer_for_you/tree/master/let_me_answer_for_you/settings.py#L185" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_input</code>(<strong><code>text</code></strong>)</p>
</blockquote>
<p>This redundancy is needed for testing</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="question_response" class="doc_header"><code>question_response</code><a href="https://github.com/kikejimenez/let_me_answer_for_you/tree/master/let_me_answer_for_you/settings.py#L190" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>question_response</code>(<strong><code>data</code></strong>, <strong><code>qa_models</code></strong>, <strong><code>num_returned_values_per_squad_model</code></strong>=<em><code>1</code></em>)</p>
</blockquote>
<p>Receive response and call get_response()</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">##Test FAQ dialog system&#39;s part</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">from</span> <span class="nn">unittest.mock</span> <span class="kn">import</span> <span class="n">patch</span>
<span class="kn">from</span> <span class="nn">shutil</span> <span class="kn">import</span> <span class="n">copyfile</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>

<span class="k">def</span> <span class="nf">mock_faq_files</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="n">faqs</span><span class="p">,</span> <span class="n">faq_dic</span><span class="p">):</span>

    <span class="n">faq_dic</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="s1">&#39;temp_faq.csv&#39;</span><span class="p">)</span>
    <span class="n">faq_dic</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="s1">&#39;temp_config_faq.json&#39;</span><span class="p">)</span>
    <span class="n">faq_dic</span><span class="p">[</span><span class="s1">&#39;df&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">faqs</span><span class="p">)</span>
    <span class="n">faq_dic</span><span class="p">[</span><span class="s1">&#39;df&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">faq_dic</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">copyfile</span><span class="p">(</span><span class="n">configs</span><span class="o">.</span><span class="n">faq</span><span class="o">.</span><span class="n">tfidf_logreg_en_faq</span><span class="p">,</span> <span class="n">faq_dic</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">])</span>

    <span class="n">updates_faq_config_file</span><span class="p">(</span>
        <span class="n">configs_path</span><span class="o">=</span><span class="n">faq_dic</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">],</span>
        <span class="n">dataset_reader</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;data_path&#39;</span><span class="p">:</span> <span class="n">faq_dic</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]}</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">mock_context_file</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="n">contexts</span><span class="p">,</span> <span class="n">context_dic</span><span class="p">):</span>

    <span class="n">context_dic</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="s1">&#39;temp_context.csv&#39;</span><span class="p">)</span>
    <span class="n">context_dic</span><span class="p">[</span><span class="s1">&#39;df&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">contexts</span><span class="p">)</span>
    <span class="n">context_dic</span><span class="p">[</span><span class="s1">&#39;df&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">context_dic</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


<span class="nd">@patch</span><span class="p">(</span><span class="s1">&#39;__main__.get_input&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_context_response_with_no_updates</span><span class="p">(</span><span class="n">mock_input</span><span class="p">):</span>
    <span class="n">mock_input</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Who is Enrique Jimenez?&#39;</span><span class="p">]</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;context&#39;</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span> <span class="s1">&#39;faq&#39;</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">str</span><span class="p">)}</span>
    <span class="n">contexts</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;context&#39;</span><span class="p">:</span>
            <span class="p">[</span>
                <span class="s1">&#39;Intekglobal has its headquarters located in TJ&#39;</span><span class="p">,</span>
                <span class="s1">&#39;In Intekglobal we care about you&#39;</span><span class="p">,</span>
                <span class="sd">&#39;&#39;&#39;Enrique Jimenez is one of the smartest minds on the planet, </span>
<span class="sd">                   he currently works as Intekglobal employee&#39;&#39;&#39;</span>
            <span class="p">],</span>
        <span class="s1">&#39;topic&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;headquarters&#39;</span><span class="p">,</span> <span class="s1">&#39;mission&#39;</span><span class="p">,</span> <span class="s1">&#39;Enrique</span><span class="se">\&#39;</span><span class="s1">s biography&#39;</span><span class="p">]</span>
    <span class="p">}</span>

    <span class="n">faqs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Question&#39;</span><span class="p">:</span>
            <span class="p">[</span><span class="s1">&#39;Minimum number of questions?&#39;</span><span class="p">,</span> <span class="s1">&#39;This is the other question?&#39;</span><span class="p">],</span>
        <span class="s1">&#39;Answer&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Two&#39;</span><span class="p">,</span> <span class="s1">&#39;yes&#39;</span><span class="p">]</span>
    <span class="p">}</span>

    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdirname</span><span class="p">:</span>

        <span class="n">mock_faq_files</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="n">faqs</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;faq&#39;</span><span class="p">])</span>
        <span class="n">mock_context_file</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="n">contexts</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;context&#39;</span><span class="p">])</span>

        <span class="n">qa_models</span> <span class="o">=</span> <span class="n">load_qa_models</span><span class="p">(</span>
            <span class="n">config_tfidf</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;faq&#39;</span><span class="p">][</span><span class="s1">&#39;config&#39;</span><span class="p">],</span> <span class="n">download</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

        <span class="n">question</span><span class="p">,</span><span class="n">responses</span> <span class="o">=</span> <span class="n">question_response</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">qa_models</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  </span><span class="si">{</span><span class="n">question</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  </span><span class="si">{</span><span class="n">responses</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="s1">&#39;Who is Enrique Jimenez?&#39;</span> <span class="o">==</span> <span class="n">question</span>
        <span class="k">assert</span> <span class="s1">&#39;one of the smartest minds on the planet&#39;</span> <span class="ow">in</span> <span class="n">responses</span>

<span class="n">test_context_response_with_no_updates</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>09:12:37 INFO:Restoring parameters from /home/jovyan/.deeppavlov/models/squad_model/model
09:13:10 INFO:Restoring parameters from /home/jovyan/.deeppavlov/models/squad_bert/model
/opt/conda/lib/python3.7/site-packages/sklearn/linear_model/logistic.py:432: FutureWarning: Default solver will be changed to &#39;lbfgs&#39; in 0.22. Specify a solver to silence this warning.
  FutureWarning)
09:13:20 DEBUG:Responses: [list([[&#39;Intekglobal&#39;], [0], [160.03579711914062]])
 list([[&#39;Intekglobal&#39;], [3], [244.86245727539062]])
 list([[&#39;one of the smartest minds on the planet&#39;], [19], [1664652.0]])]
09:13:20 DEBUG:Top Responses: [&#39;one of the smartest minds on the planet&#39;]
09:13:24 DEBUG:Responses: [list([[&#39;&#39;], [-1], [0.0011892060283571482]])
 list([[&#39;&#39;], [-1], [0.01691678911447525]])
 list([[&#39;one of the smartest minds on the planet, \n                   he currently works as Intekglobal employee&#39;], [19], [18812.87109375]])]
09:13:24 DEBUG:Top Responses: [&#39;one of the smartest minds on the planet, \n                   he currently works as Intekglobal employee&#39;]
09:13:24 DEBUG:  Who is Enrique Jimenez?
09:13:24 DEBUG:  Who is Enrique Jimenez?:

1: one of the smartest minds on the planet, 
                   he currently works as Intekglobal employee
2: one of the smartest minds on the planet
3: yes

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="new_question_answer" class="doc_header"><code>new_question_answer</code><a href="https://github.com/kikejimenez/let_me_answer_for_you/tree/master/let_me_answer_for_you/settings.py#L202" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>new_question_answer</code>(<strong><code>data</code></strong>, <strong><code>qa_models</code></strong>)</p>
</blockquote>
<p>Asks for a new question-answer pair; store the result in the
faq dataframe and retrain the faq-model</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#tests</span>


<span class="nd">@patch</span><span class="p">(</span><span class="s1">&#39;__main__.get_input&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_new_question_answer</span><span class="p">(</span><span class="n">mock_input</span><span class="p">):</span>
    <span class="n">question</span> <span class="o">=</span> <span class="s1">&#39;What is Intekglobal?&#39;</span>
    <span class="n">new_answer</span> <span class="o">=</span> <span class="s1">&#39;Intekglobal is one of the best companies in the world&#39;</span>
    <span class="n">mock_input</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="n">question</span><span class="p">,</span> <span class="n">new_answer</span><span class="p">]</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;context&#39;</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span> <span class="s1">&#39;faq&#39;</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">str</span><span class="p">)}</span>

    <span class="n">faqs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Question&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Who  owns Tesla Company?&#39;</span><span class="p">,</span> <span class="s1">&#39;Is this is heaven?&#39;</span><span class="p">],</span>
        <span class="s1">&#39;Answer&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s1">&#39;Elon Musk is the owner of Tesla&#39;</span><span class="p">,</span> <span class="s1">&#39;No, it is life on earth&#39;</span>
        <span class="p">]</span>
    <span class="p">}</span>

    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdirname</span><span class="p">:</span>

        <span class="n">mock_faq_files</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="n">faqs</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;faq&#39;</span><span class="p">])</span>
        <span class="n">qa_models</span> <span class="o">=</span> <span class="n">load_qa_models</span><span class="p">(</span>
            <span class="n">config_tfidf</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;faq&#39;</span><span class="p">][</span><span class="s1">&#39;config&#39;</span><span class="p">],</span> <span class="n">download</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="n">new_question_answer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">qa_models</span><span class="p">)</span>
        <span class="n">updated_faq</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;faq&#39;</span><span class="p">][</span><span class="s1">&#39;path&#39;</span><span class="p">])</span>

        <span class="k">assert</span> <span class="n">updated_faq</span><span class="p">[</span><span class="n">updated_faq</span><span class="p">[</span><span class="s1">&#39;Answer&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">new_answer</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>


<span class="n">test_new_question_answer</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>09:13:50 INFO:Restoring parameters from /home/jovyan/.deeppavlov/models/squad_model/model
09:14:23 INFO:Restoring parameters from /home/jovyan/.deeppavlov/models/squad_bert/model
/opt/conda/lib/python3.7/site-packages/sklearn/linear_model/logistic.py:432: FutureWarning: Default solver will be changed to &#39;lbfgs&#39; in 0.22. Specify a solver to silence this warning.
  FutureWarning)
/opt/conda/lib/python3.7/site-packages/sklearn/linear_model/logistic.py:432: FutureWarning: Default solver will be changed to &#39;lbfgs&#39; in 0.22. Specify a solver to silence this warning.
  FutureWarning)
/opt/conda/lib/python3.7/site-packages/sklearn/linear_model/logistic.py:469: FutureWarning: Default multi_class will be changed to &#39;auto&#39; in 0.22. Specify the multi_class option to silence this warning.
  &#34;this warning.&#34;, FutureWarning)
09:14:35 INFO:FAQ dataset and model updated..
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="new_context" class="doc_header"><code>new_context</code><a href="https://github.com/kikejimenez/let_me_answer_for_you/tree/master/let_me_answer_for_you/settings.py#L223" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>new_context</code>(<strong><code>data</code></strong>)</p>
</blockquote>
<p>Stores the new context in the context dataframe</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@patch</span><span class="p">(</span><span class="s1">&#39;__main__.get_input&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_new_context</span><span class="p">(</span><span class="n">mock_input</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;context&#39;</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span> <span class="s1">&#39;faq&#39;</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">str</span><span class="p">)}</span>

    <span class="n">new_topic</span> <span class="o">=</span> <span class="s1">&#39;AI Tool &amp; Chatbot Development&#39;</span>
    <span class="n">new_context_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>

<span class="s1">A chatbot is an important tool for simulating intelligent conversations with humans.</span>
<span class="s1">Intekglobal chatbots efficiently live message on platforms such as Facebook Messenger, </span>
<span class="s1">Slack, and Telegram. But chatbots are more than just a cool technology advancement.</span>

<span class="s1">&#39;&#39;&#39;</span>
    <span class="n">contexts</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;context&#39;</span><span class="p">:</span>
            <span class="p">[</span>
                <span class="sd">&#39;&#39;&#39;One of the greatest punk rock bands from all the time</span>
<span class="sd">                is the Ramones.</span>
<span class="sd">                &#39;&#39;&#39;</span>
            <span class="p">],</span>
        <span class="s1">&#39;topic&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Ramones&#39;</span><span class="p">]</span>
    <span class="p">}</span>
    
    <span class="n">mock_input</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="n">new_topic</span><span class="p">,</span> <span class="n">new_context_str</span><span class="p">]</span>
    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdirname</span><span class="p">:</span>

        
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">new_context</span><span class="p">))</span>
        <span class="n">mock_context_file</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="n">contexts</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;context&#39;</span><span class="p">])</span>
        <span class="n">new_context</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">updated_faq</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;context&#39;</span><span class="p">][</span><span class="s1">&#39;path&#39;</span><span class="p">])</span>

        <span class="k">assert</span> <span class="n">updated_faq</span><span class="p">[</span><span class="n">updated_faq</span><span class="o">.</span><span class="n">topic</span> <span class="o">==</span> <span class="n">new_topic</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>


<span class="n">test_new_context</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>09:14:35 DEBUG:&lt;function new_context at 0x7f5d18456680&gt;
/opt/conda/lib/python3.7/site-packages/pandas/core/frame.py:7138: FutureWarning: Sorting because non-concatenation axis is not aligned. A future version
of pandas will change to not sort by default.

To accept the future behavior, pass &#39;sort=False&#39;.

To retain the current behavior and silence the warning, pass &#39;sort=True&#39;.

  sort=sort,
09:14:35 INFO:contexts dataset updated..
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="set_minimal_faq_questions" class="doc_header"><code>set_minimal_faq_questions</code><a href="https://github.com/kikejimenez/let_me_answer_for_you/tree/master/let_me_answer_for_you/settings.py#L241" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>set_minimal_faq_questions</code>(<strong><code>data</code></strong>)</p>
</blockquote>
<p>Sets the faq configurations that assure a proper operation</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="set_minimal_contexts" class="doc_header"><code>set_minimal_contexts</code><a href="https://github.com/kikejimenez/let_me_answer_for_you/tree/master/let_me_answer_for_you/settings.py#L264" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>set_minimal_contexts</code>(<strong><code>data</code></strong>)</p>
</blockquote>
<p>Sets the context configurations that assure a proper operation</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="set_data_dict" class="doc_header"><code>set_data_dict</code><a href="https://github.com/kikejimenez/let_me_answer_for_you/tree/master/let_me_answer_for_you/settings.py#L277" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>set_data_dict</code>(<strong><code>file</code></strong>, <strong><code>data</code></strong>, <strong><code>question_type</code></strong>, <strong><code>data_dir</code></strong>)</p>
</blockquote>
<p>Creates unexistent files</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="load_and_prepare_data" class="doc_header"><code>load_and_prepare_data</code><a href="https://github.com/kikejimenez/let_me_answer_for_you/tree/master/let_me_answer_for_you/settings.py#L294" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>load_and_prepare_data</code>(<strong><code>context_data_file</code></strong>, <strong><code>faq_data_file</code></strong>, <strong><code>data</code></strong>, <strong><code>configs_faq</code></strong>)</p>
</blockquote>
<p>Calls the context and faq configuration routines</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#tests</span>
<span class="kn">import</span> <span class="nn">tempfile</span><span class="o">,</span><span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">shutil</span> <span class="kn">import</span> <span class="n">rmtree</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">path</span><span class="p">,</span><span class="n">popen</span>
<span class="kn">from</span> <span class="nn">unittest.mock</span> <span class="kn">import</span> <span class="n">patch</span>
<span class="c1">#from let_me_answer_for_you.settings import *</span>


<span class="k">def</span> <span class="nf">test_set_minimal_faqs_with_more_than_one_question</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdirname</span><span class="p">:</span>
        <span class="n">data_file</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="s1">&#39;tmp_data.csv&#39;</span><span class="p">)</span>
        <span class="n">questions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a?&#39;</span><span class="p">,</span> <span class="s1">&#39;b?&#39;</span><span class="p">]</span>
        <span class="n">answers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Question&#39;</span><span class="p">:</span> <span class="n">questions</span><span class="p">,</span> <span class="s1">&#39;Answer&#39;</span><span class="p">:</span> <span class="n">answers</span><span class="p">})</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">data_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;df&#39;</span><span class="p">:</span> <span class="n">df</span><span class="p">,</span> <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">data_file</span><span class="p">}</span>
        <span class="n">set_minimal_faq_questions</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;df&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span>


<span class="k">def</span> <span class="nf">test_set_minimal_faqs_with_less_than_two_questions</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdirname</span><span class="p">:</span>
        <span class="n">data_file</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="s1">&#39;tmp_data.csv&#39;</span><span class="p">)</span>
        <span class="n">questions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a?&#39;</span><span class="p">]</span>
        <span class="n">answers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Question&#39;</span><span class="p">:</span> <span class="n">questions</span><span class="p">,</span> <span class="s1">&#39;Answer&#39;</span><span class="p">:</span> <span class="n">answers</span><span class="p">})</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">data_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;df&#39;</span><span class="p">:</span> <span class="n">df</span><span class="p">,</span> <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">data_file</span><span class="p">}</span>

        <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;df&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>

        <span class="n">set_minimal_faq_questions</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;df&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span>
        <span class="k">assert</span> <span class="nb">any</span><span class="p">(</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;df&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Question</span> <span class="o">==</span> <span class="s1">&#39;Is this the Intekglobal Dialog System?&#39;</span>
        <span class="p">)</span>


<span class="k">def</span> <span class="nf">test_set_minimal_contexts</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdirname</span><span class="p">:</span>
        <span class="n">data_file</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="s1">&#39;tmp_data.csv&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;df&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(),</span> <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">data_file</span><span class="p">}</span>
        <span class="n">set_minimal_contexts</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">])</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;df&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;topic&#39;</span><span class="p">,</span> <span class="s1">&#39;context&#39;</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">test_set_data_dict_no_file</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdirname</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;context&#39;</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">str</span><span class="p">)}</span>
        <span class="n">set_data_dict</span><span class="p">(</span>
            <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;context&#39;</span><span class="p">],</span>
            <span class="n">data_dir</span><span class="o">=</span><span class="n">tmpdirname</span><span class="p">,</span>
            <span class="n">question_type</span><span class="o">=</span><span class="s1">&#39;context&#39;</span>
        <span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;context&#39;</span><span class="p">][</span><span class="s1">&#39;path&#39;</span><span class="p">])</span>


<span class="nd">@patch</span><span class="p">(</span><span class="s1">&#39;__main__.popen&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_load_and_prepare_data</span><span class="p">(</span><span class="n">mock_popen</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdirname</span><span class="p">:</span>
        <span class="n">mock_popen</span><span class="p">(</span><span class="s2">&quot;$PWD&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="n">tmpdirname</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;context&#39;</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span> <span class="s1">&#39;faq&#39;</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">str</span><span class="p">)}</span>

        <span class="n">load_and_prepare_data</span><span class="p">(</span>
            <span class="n">context_data_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">faq_data_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
            <span class="n">configs_faq</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span>
        <span class="n">data_dir</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">)</span>
        <span class="c1">#config_file = path.join(tmpdirname,&#39;config_faq.json&#39;)</span>
        <span class="k">assert</span> <span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">data_dir</span><span class="p">)</span>


<span class="n">test_set_minimal_faqs_with_more_than_one_question</span><span class="p">()</span>
<span class="n">test_set_minimal_faqs_with_less_than_two_questions</span><span class="p">()</span>
<span class="n">test_set_minimal_contexts</span><span class="p">()</span>
<span class="n">test_set_data_dict_no_file</span><span class="p">()</span>
<span class="n">test_load_and_prepare_data</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>09:14:35 INFO: File created at /tmp/tmpe1fzbn5r/tmp_data.csv
09:14:35 INFO: File created at /tmp/tmpi4mgn_tl/tmp_data.csv
09:14:35 INFO: File created at /tmp/tmp006qpt5n/context_data.csv
09:14:35 DEBUG:{&#39;context&#39;: defaultdict(&lt;class &#39;str&#39;&gt;, {&#39;path&#39;: &#39;/tmp/tmp006qpt5n/context_data.csv&#39;, &#39;df&#39;: Empty DataFrame
Columns: [topic, context]
Index: []})}
09:14:35 INFO:Data directory created at /tmp/tmpn3sct0bz/data
09:14:35 INFO: File created at /tmp/tmpn3sct0bz/data/faq_data.csv
09:14:35 INFO: File created at /tmp/tmpn3sct0bz/data/context_data.csv
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

